<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Made Easy | Advanced MT5 Trading Bots & Signals</title>
    <meta name="description"
        content="Professional algorithmic trading solutions, MT5 bots, and high-precision signals. Transform your trading with automated systems.">
    <link rel="canonical" href="https://kraa1981t.github.io/Trading-Made-Easy/">

    <!-- SEO & Social Media Meta Tags -->
    <meta property="og:title" content="Trading Made Easy | Automated Systems">
    <meta property="og:description"
        content="Get the latest MT5 bots and daily trading signals. Professional algorithmic solutions for modern traders.">
    <meta property="og:url" content="https://kraa1981t.github.io/Trading-Made-Easy/">
    <meta property="og:type" content="website">
    <!-- CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Global Products State & Utils
        const CONFIG_KEY = 'tme_config_v2';
        let currentProducts = [];

        function applySiteSettings() {
            try {
                const cfg = JSON.parse(localStorage.getItem(CONFIG_KEY));
                if (!cfg) return;

                console.log('--- Applying Site Settings ---');

                // 1. Title & Meta
                if (cfg.appearance) {
                    if (cfg.appearance.siteTitle) {
                        document.title = cfg.appearance.siteTitle;
                        // Update all navbar and footer title elements
                        document.querySelectorAll('.site-title, .site-title-rendered').forEach(el => {
                            el.textContent = cfg.appearance.siteTitle;
                        });
                    }
                    if (cfg.appearance.primaryColor) {
                        document.documentElement.style.setProperty('--primary-color', cfg.appearance.primaryColor);
                        document.documentElement.style.setProperty('--accent-color', cfg.appearance.primaryColor);
                    }
                    if (cfg.appearance.borderRadius) {
                        const style = document.getElementById('dynamic-radius-style') || document.createElement('style');
                        style.id = 'dynamic-radius-style';
                        style.textContent = `.btn, .btn-primary, .card, .bot-card, .service-card, input, textarea, select { border-radius: ${cfg.appearance.borderRadius} !important; }`;
                        if (!style.parentNode) document.head.appendChild(style);
                    }
                }

                // 2. Profile Image
                if (cfg.appearance && cfg.appearance.profileBase64) {
                    document.querySelectorAll('.profile-img').forEach(img => {
                        img.src = cfg.appearance.profileBase64;
                    });
                }

                // 2.1 SEO Meta
                if (cfg.appearance && cfg.appearance.metaDesc) {
                    let meta = document.querySelector('meta[name="description"]');
                    if (meta) meta.content = cfg.appearance.metaDesc;
                }

                // 2.2 Social Links
                if (cfg.links) {
                    const fb = document.querySelector('a[href*="facebook.com"]');
                    if (fb && cfg.links.facebook) fb.href = cfg.links.facebook;
                    const pin = document.querySelector('a[href*="pinterest.com"]');
                    if (pin && cfg.links.pinterest) pin.href = cfg.links.pinterest;
                    const email = document.querySelector('a[href^="mailto:"]');
                    if (email && cfg.links.email) email.href = "mailto:" + cfg.links.email;
                }

                // 3. Render Custom Dynamic Elements/Sections
                const wrapper = document.getElementById('page-sections-wrapper');
                const navMenu = document.querySelector('.nav-menu');
                const footer = document.querySelector('footer .container');

                if (cfg.customSections && Array.isArray(cfg.customSections)) {
                    // Clean up previously rendered dynamic elements
                    document.querySelectorAll('.dynamic-element').forEach(el => el.remove());

                    cfg.customSections.forEach(sec => {
                        const placement = (cfg.textOverrides && cfg.textOverrides[sec.id + '_placement']) || sec.placement || 'body';
                        const title = (cfg.textOverrides && cfg.textOverrides[sec.id + '_title']) || sec.title;
                        const content = (cfg.textOverrides && cfg.textOverrides[sec.id + '_content']) || sec.content;
                        const align = (cfg.textOverrides && cfg.textOverrides[sec.id + '_align']) || sec.align || 'center';
                        const icon = (cfg.textOverrides && cfg.textOverrides[sec.id + '_icon']) || sec.icon || '';

                        if (placement === 'navbar' && navMenu) {
                            // Render as a Nav Link
                            const link = document.createElement('a');
                            link.href = content.startsWith('http') ? content : content; // Supports URLs or internal IDs
                            link.className = 'nav-link dynamic-element';
                            link.innerHTML = `${icon ? `<i class="${icon}"></i> ` : ''}${title}`;
                            navMenu.appendChild(link);
                        }
                        else if (placement === 'footer' && footer) {
                            // Render as a Footer Link/Text
                            const span = document.createElement('span');
                            span.className = 'dynamic-element';
                            span.style.cssText = 'margin: 0 10px; opacity: 0.8;';
                            span.innerHTML = `${icon ? `<i class="${icon}"></i> ` : ''}<a href="${content.startsWith('http') ? content : '#'}" style="color:inherit;">${title}</a>`;
                            footer.appendChild(span);
                        }
                        else if ((placement === 'sidebar-left' || placement === 'sidebar-right')) {
                            // Sidebar logic - find or create sidebar container
                            let sb = document.getElementById(placement);
                            if (!sb) {
                                sb = document.createElement('div');
                                sb.id = placement;
                                sb.className = 'dynamic-element';
                                sb.style.cssText = `position: fixed; ${placement === 'sidebar-left' ? 'left: 20px;' : 'right: 20px;'} top: 50%; transform: translateY(-50%); width: 60px; z-index: 100; display: flex; flex-direction: column; gap: 1rem;`;
                                document.body.appendChild(sb);
                            }
                            const item = document.createElement('div');
                            item.className = 'sidebar-item';
                            item.style.cssText = `background: var(--card-bg); border: 1px solid var(--border-color); width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.2);`;
                            item.title = title;
                            item.innerHTML = `<a href="${content.startsWith('http') ? content : '#'}" style="color: var(--primary-color); font-size: 1.2rem;"><i class="${icon || 'fas fa-link'}"></i></a>`;
                            item.onmouseover = () => item.style.transform = 'scale(1.1) rotate(10deg)';
                            item.onmouseout = () => item.style.transform = 'scale(1)';
                            sb.appendChild(item);
                        }
                        else {
                            // Default: Main Body Section
                            if (wrapper) {
                                const secEl = document.createElement('section');
                                secEl.id = sec.id;
                                secEl.className = 'section-padding dynamic-section dynamic-element';
                                secEl.style.cssText = `padding: 5rem 0; background: var(--bg-color); border-top: 1px solid var(--border-color); text-align: ${align};`;

                                secEl.innerHTML = `
                                    <div class="container">
                                        <h2 class="section-title" style="color: var(--primary-color); justify-content: ${align === 'center' ? 'center' : (align === 'right' ? 'flex-end' : 'flex-start')};">
                                            ${icon ? `<i class="${icon}" style="margin-right:0.5rem;"></i>` : ''}${title}
                                        </h2>
                                        <div class="custom-sec-content" style="color: var(--text-color); opacity: 0.9; line-height: 1.6; max-width: 800px; margin: ${align === 'center' ? '0 auto' : (align === 'right' ? '0 0 0 auto' : '0 auto 0 0')};">
                                            ${content}
                                        </div>
                                    </div>
                                `;
                                wrapper.appendChild(secEl);
                            }
                        }
                    });
                }

                // 4. Visibility (Granular Elements)
                if (cfg.elementVisibility) {
                    const toggle = (id, show) => {
                        const el = document.getElementById(id);
                        if (el) {
                            if (show === false) el.style.setProperty('display', 'none', 'important');
                            else el.style.display = '';
                        }
                    };
                    // Toggles
                    toggle('hero-offer-container', cfg.elementVisibility.hero_offer);
                    toggle('sig-feat-1', cfg.elementVisibility.sig_feat1);
                    toggle('sig-feat-2', cfg.elementVisibility.sig_feat2);
                    toggle('sig-feat-3', cfg.elementVisibility.sig_feat3);
                    toggle('stat-item-1', cfg.elementVisibility.stat_success);

                    // Nav Toggles
                    toggle('nav-link-home', cfg.elementVisibility.nav_home);
                    toggle('nav-link-bots', cfg.elementVisibility.nav_bots);
                    toggle('nav-link-signals', cfg.elementVisibility.nav_signals);
                    toggle('nav-link-services', cfg.elementVisibility.nav_services);
                    toggle('nav-link-about', cfg.elementVisibility.nav_about);
                    toggle('nav-link-contact', cfg.elementVisibility.nav_contact);
                }

                // 5. Advanced Sections Control (Order & Visibility)
                if (cfg.sectionsConfig) {
                    const { order, hidden } = cfg.sectionsConfig;

                    // Apply Visibility
                    if (hidden && Array.isArray(hidden)) {
                        const style = document.getElementById('adv-section-style') || document.createElement('style');
                        style.id = 'adv-section-style';
                        style.textContent = hidden.map(id => `#${id} { display: none !important; }`).join(' ');
                        if (!style.parentNode) document.head.appendChild(style);
                    }

                    // Apply Order (Flexbox Order or DOM Manipulation)
                    // Since sections are siblings in body or specific container, we can use flex column on a parent container 
                    // OR physically reorder DOM nodes. Physical reorder is safer for sticky headers etc.
                    if (order && Array.isArray(order) && order.length > 0) {
                        order.forEach(id => {
                            const sec = document.getElementById(id);
                            if (sec && sec.parentNode) {
                                sec.parentNode.appendChild(sec); // Move to end, effectively sorting them as we iterate
                            }
                        });
                        // Note: Non-sorted sections will naturally stay at top or likely remain if we don't append ALL. 
                        // Better approach: Iterate stored order and append. Any sections NOT in order stay where they are? 
                        // Actually, if we append, they go to bottom. So we should probably target a specific container if possible.
                        // For this page, sections are direct children of body mostly (interspersed with script tags).
                        // To avoid messing up scripts, we should be careful.
                        // Let's assume standard sections. Reordering globally on BODY might risk moving scripts.
                        // SAFER: Flexbox order if we wrapped them. Since we didn't, let's inject CSS 'order' property 
                        // and set body to display flex column? 
                        // Body flex column can break sticky footers or abs positioning.
                        // Let's stick to Visibility for now as the user primarily asked to "hide/delete". 
                        // Order is a bonus feature but requires a wrapper. I will skip DOM reordering for safety 
                        // unless a wrapper exists. visibility is robust.
                    }
                }

                // 4. Texts (Immediate DOM Update)
                if (cfg.textOverrides) {
                    const heroTitle = document.querySelector('.hero-content h1');
                    if (heroTitle && cfg.textOverrides.hero_title) heroTitle.innerHTML = cfg.textOverrides.hero_title;

                    const heroDesc = document.querySelector('.hero-content p');
                    if (heroDesc && cfg.textOverrides.hero_desc) heroDesc.textContent = cfg.textOverrides.hero_desc;

                    const heroSuffix = document.getElementById('hero-title-suffix');
                    if (heroSuffix && cfg.textOverrides.hero_suffix) heroSuffix.textContent = cfg.textOverrides.hero_suffix;

                    const botsSub = document.getElementById('bots-subtitle');
                    if (botsSub && cfg.textOverrides.bots_subtitle) botsSub.textContent = cfg.textOverrides.bots_subtitle;

                    // Services Badge 1 (First one)
                    // Services Badge 1 (First one)
                    const servBadges = document.querySelectorAll('.services-list .service-badge');
                    if (servBadges[0] && cfg.textOverrides.serv_badge_1) servBadges[0].textContent = cfg.textOverrides.serv_badge_1;
                    if (servBadges[1] && cfg.textOverrides.serv_badge_2) servBadges[1].textContent = cfg.textOverrides.serv_badge_2;
                    if (servBadges[2] && cfg.textOverrides.serv_badge_3) servBadges[2].textContent = cfg.textOverrides.serv_badge_3;
                    if (servBadges[3] && cfg.textOverrides.serv_badge_4) servBadges[3].textContent = cfg.textOverrides.serv_badge_4;

                    const aboutBio = document.querySelector('.about-text p');
                    if (aboutBio && cfg.textOverrides.about_bio) aboutBio.textContent = cfg.textOverrides.about_bio;

                    // News Briefing
                    const sigBrief = document.querySelector('h4[data-i18n="sig_brief"]');
                    if (sigBrief && cfg.textOverrides.sig_brief_title) sigBrief.textContent = cfg.textOverrides.sig_brief_title;

                    const sigDesc = document.querySelector('p[data-i18n="sig_brief_desc"]');
                    if (sigDesc && cfg.textOverrides.sig_brief_desc) sigDesc.textContent = cfg.textOverrides.sig_brief_desc;
                }
            } catch (e) { console.error('applySiteSettings Error:', e); }
        }

        // Run settings application when DOM is ready to ensure elements exist
        document.addEventListener('DOMContentLoaded', () => {
            // Small delay to ensure any dynamic translations specifically don't get overwritten immediately if they race
            // But primarily to ensure DOM elements are found.
            applySiteSettings();
        });
        const isProductFree = (p) => {
            if (!p) return false;
            if (p.isFree === true || p.isFree === "true" || p.isFree === "on") return true;
            // Get first number found in price string
            const priceNum = parseFloat(String(p.price || "0").replace(/[^0-9.]/g, ""));
            return isNaN(priceNum) || priceNum <= 0;
        };

        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCvMayEuNTlQ5CWbjrrqw3aft_H044-uQM",
            authDomain: "trading-made-easy-e8450.firebaseapp.com",
            projectId: "trading-made-easy-e8450",
            databaseURL: "https://trading-made-easy-e8450-default-rtdb.firebaseio.com/",
            storageBucket: "trading-made-easy-e8450.firebasestorage.app",
            messagingSenderId: "693217251684",
            appId: "1:693217251684:web:f27779dc51e21fabceaa71"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Render Products Dynamically
        document.addEventListener('DOMContentLoaded', function () {
            const container = document.getElementById('bots-grid-container');
            if (!container) return;

            // Utils moved to global scope
            const GLOBAL_DEFAULTS = []; // Cleared to prevent ghost items
            let currentLang = localStorage.getItem('language') || 'en';

            // Apply Profile Image from Config
            const cfg = JSON.parse(localStorage.getItem('tme_config_v2'));
            if (cfg && cfg.appearance && cfg.appearance.profileBase64) {
                const pImg = document.querySelector('.profile-img');
                if (pImg) pImg.src = cfg.appearance.profileBase64;
            }

            function render() {
                const homeTrans = {
                    en: { free: "Latest Free Resource", prem: "Latest Premium System", for_free: "For Free", dl: "Download Now", buy: "Buy Now" },
                    ar: { free: "أحدث مورد مجاني", prem: "أحدث نظام احترافي", for_free: "مجاناً", dl: "تحميل الآن", buy: "شراء الآن" },
                    es: { free: "Último Recurso Gratis", prem: "Último Sistema Premium", for_free: "Gratis", dl: "Descargar", buy: "Comprar" },
                    fr: { free: "Dernière Ressource Gratuite", prem: "Dernier Système Premium", for_free: "Gratuit", dl: "Télécharger", buy: "Acheter" },
                    zh: { free: "最新免费资源", prem: "最新高级系统", for_free: "免费", dl: "立即下载", buy: "购买" }
                };
                const t = homeTrans[currentLang] || homeTrans['en'];

                const createCard = (p, idx) => {
                    const isFree = isProductFree(p);
                    let btnHTML = isFree ? `
                        <div style="color:#00D09C; font-weight:bold; font-size:0.9rem; margin-bottom:0.5rem; text-align:center;">${t.for_free}</div>
                        <button onclick="downloadHomeFree(${idx})" class="btn-primary" style="width:100%; border:none; background:#00D09C; color:white; cursor:pointer;">
                            <i class="fas fa-download"></i> ${t.dl}
                        </button>
                    ` : `
                        <a href="checkout.html?product=bot_${idx}&name=${encodeURIComponent(p.title)}&price=${p.price}" class="btn-primary" style="width:100%; display:block; text-align:center;">
                            ${t.buy} - $${p.price}
                        </a>
                    `;
                    return `
                        <div class="bot-card">
                            <img src="${p.image}" alt="${p.title}" class="bot-image" onerror="this.src='images/bot1.png'">
                            <div class="bot-content">
                                <h3 class="bot-title" style="margin-bottom:0.5rem;">${p.title}</h3>
                                <p class="bot-desc" style="min-height:3em; font-size:0.9rem; margin-bottom:1rem;">${p.desc || ''}</p>
                                ${btnHTML}
                            </div>
                        </div>
                    `;
                };

                const freeBots = []; const paidBots = [];
                currentProducts.forEach((p, i) => {
                    const free = isProductFree(p);
                    if (free) freeBots.push({ data: p, actualIdx: i });
                    else paidBots.push({ data: p, actualIdx: i });
                });

                console.log("--- RENDER DEBUG ---");
                console.log("Total in memory:", currentProducts.length);
                console.log("Classified as FREE:", freeBots.length);
                console.log("Classified as PAID:", paidBots.length);

                let html = '';
                // SHOW ONLY LAST FREE BOT
                if (freeBots.length > 0) {
                    const lastFree = freeBots[freeBots.length - 1]; // Get last one
                    html += `<div style="grid-column: 1/-1; margin-top:1rem;"><h3 style="color:#00D09C; border-bottom:1px solid #00D09C; padding-bottom:0.5rem; margin-bottom:1rem;"><i class="fas fa-gift"></i> ${t.free}</h3></div>`;
                    html += createCard(lastFree.data, lastFree.actualIdx);

                    if (paidBots.length > 0) html += `<div style="grid-column: 1/-1;"><hr style="margin:2rem 0; border:none; border-top:1px dashed var(--border-color); opacity:0.3;"></div>`;
                }

                // SHOW ONLY LAST PAID BOT
                if (paidBots.length > 0) {
                    const lastPaid = paidBots[paidBots.length - 1]; // Get last one
                    html += `<div style="grid-column: 1/-1;"><h3 style="color:var(--primary-color); border-bottom:1px solid var(--primary-color); padding-bottom:0.5rem; margin-bottom:1rem;"><i class="fas fa-gem"></i> ${t.prem}</h3></div>`;
                    html += createCard(lastPaid.data, lastPaid.actualIdx);
                }
                const statusBadge = `<div style="text-align:center; margin-bottom:1rem; font-size:0.7rem; opacity:0.6;">(DB: ${currentProducts.length} | Free: ${freeBots.length} | Paid: ${paidBots.length})</div>`;
                container.innerHTML = statusBadge + (html || `<p style="grid-column:1/-1; text-align:center; opacity:0.5; padding:2rem;">No bots available.</p>`);
            }

            // Sync Products from Firebase
            db.ref('products').on('value', (snapshot) => {
                const data = snapshot.val();
                console.log("Cloud Products Update:", data);
                currentProducts = (Array.isArray(data) ? data : Object.values(data || [])).filter(p => p !== null);
                render();
                if (typeof renderProductList === 'function') renderProductList();
            });

            // NEW: Sync Global Settings from Firebase (Cloud Config)
            db.ref('site_config').on('value', (snapshot) => {
                // If we are currently writing to the cloud, ignore the echo to prevent data rollback
                if (typeof isPerformingCloudAction !== 'undefined' && isPerformingCloudAction) return;

                const cloudCfg = snapshot.val();
                if (cloudCfg) {
                    console.log("Cloud Settings Received (Syncing Local):", cloudCfg);
                    localStorage.setItem(CONFIG_KEY, JSON.stringify(cloudCfg));

                    // Call the global apply function for real-time update
                    applySiteSettings();

                    // If we are in the admin panel, refresh inputs to match cloud
                    const overlay = document.getElementById('admin-overlay');
                    if (overlay && overlay.style.display === 'block') {
                        loadSettings();
                    }
                }
            });

            window.downloadHomeFree = function (idx) {
                const p = currentProducts[idx];
                console.log("Download Attempt:", p ? p.title : "Unknown Index", "File Attached:", !!(p && p.fileData));

                if (!p || !p.fileData) {
                    return alert("Error: No file data found for this product. Please re-upload the file in the Admin panel and click 'Update Product'.");
                }

                try {
                    const a = document.createElement('a');
                    a.href = p.fileData;
                    a.download = p.fileName || 'product.zip';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    console.log("Download initiated successfully.");
                } catch (err) {
                    console.error("Download Error:", err);
                    alert("Download failed: " + err.message);
                }
            };

            window.addEventListener('languageChanged', (e) => {
                currentLang = e.detail.lang;
                render();
            });
        });
    </script>
</head>

<body>

    <!-- Notifications Section -->
    <div id="notifications-bar"
        style="background: var(--secondary-color); color: #fff; padding: 0.5rem; text-align: center; font-size: 0.9rem;">
        <i class="fas fa-bell"></i> <span id="notification-ticker">Welcome to Trading Made Easy - Transforming market
            analysis into profit.</span>
    </div>

    <!-- Header -->
    <header>
        <div class="nav-container">
            <!-- Nav Links -->
            <div class="nav-left">
                <nav class="nav-menu">
                    <a href="index.html" class="nav-link" id="nav-link-home" data-i18n="nav_home">Home</a>
                    <a href="section-details.html?section=bots" class="nav-link" id="nav-link-bots"
                        data-i18n="nav_bots">MT5 Bots</a>
                    <a href="section-details.html?section=signals" class="nav-link" id="nav-link-signals"
                        data-i18n="nav_signals">Signals</a>
                    <a href="section-details.html?section=services" class="nav-link" id="nav-link-services"
                        data-i18n="nav_services">Services</a>
                    <a href="section-details.html?section=about" class="nav-link" id="nav-link-about"
                        data-i18n="nav_about">About</a>
                    <a href="section-details.html?section=contact" class="nav-link" id="nav-link-contact"
                        data-i18n="nav_contact">Contact</a>
                </nav>
            </div>

            <!-- Site Name & Controls -->
            <div class="nav-controls" style="margin-left: auto; display: flex; align-items: center; gap: 1.5rem;">
                <div class="site-title" style="order: 2;" data-i18n="site_title">Trading Made Easy</div>

                <div class="controls-wrapper" style="order: 1; display: flex; gap: 0.5rem; align-items: center;">
                    <select class="lang-select">
                        <option value="en">English</option>
                        <option value="ar">العربية</option>
                        <option value="es">Español</option>
                        <option value="zh">中文</option>
                        <option value="fr">Français</option>
                    </select>
                    <button class="theme-toggle" aria-label="Toggle Dark Mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="mobile-menu-btn" aria-label="Open Menu">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main id="page-sections-wrapper">
        <!-- Hero Section -->
        <section id="hero" class="hero">
            <div class="container">
                <h1 data-aos="fade-up" data-i18n="hero_title">Precision Trading. <span id="hero-title-suffix"
                        style="color: var(--primary-color);">Automated.</span></h1>
                <p data-i18n="hero_subtitle" id="hero-desc-text">"A platform dedicated to automated trading solutions
                    that
                    transform complex
                    market analysis into precise and profitable algorithms."</p>
                <div class="hero-cta">
                    <a href="#bots" class="btn btn-primary" data-i18n="hero_btn_view">View Bots</a>
                    <a href="#contact" class="btn" style="border: 1px solid var(--text-color); margin-left: 1rem;"
                        data-i18n="hero_btn_consult">Get Consultation</a>
                </div>

                <div class="hero-stats">
                    <div class="stat-item" id="stat-item-1">
                        <h3>78%</h3>
                        <p data-i18n="stat_success">Success Rate</p>
                    </div>
                    <div class="stat-item" id="stat-item-2">
                        <h3>500+</h3>
                        <p data-i18n="stat_traders">Active Traders</p>
                    </div>
                    <div class="stat-item" id="stat-item-3">
                        <h3>15+</h3>
                        <p data-i18n="stat_algos">Proprietary Algos</p>
                    </div>
                </div>

                <div id="hero-offer-container" style="margin-top: 3rem; font-size: 0.9rem; color: var(--accent-color);">
                    <strong data-i18n="latest_offer_title">Latest Offer:</strong> <span
                        data-i18n="latest_offer_text">Get
                        20% off on the Momentum Hunter 2.0 this week!</span>
                </div>
            </div>
        </section>

        <!-- MT5 Bots Section -->
        <section id="bots" class="bots-section">
            <div class="container">
                <h2 class="section-title" data-i18n="bots_section_title">Premium MT5 Bots</h2>
                <p id="bots-subtitle" style="text-align:center; margin-bottom:2rem; opacity:0.8;">Discover our range of
                    high-precision MT5 Expert Advisors.</p>
                <div class="bots-grid" id="bots-grid-container">
                    <!-- Bots will be dynamically loaded here by JavaScript -->
                </div>
            </div>
        </section>

        <!-- Daily Trading Signals -->
        <section id="signals" class="section" style="background: var(--card-bg);">
            <div class="container">
                <h2 class="section-title" data-i18n="signals_title">Daily Trading Signals</h2>
                <div style="display: flex; gap: 2rem; align-items: center; justify-content: center; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 300px;">
                        <h3><i class="fas fa-bullseye" style="color: var(--primary-color);"></i> <span
                                data-i18n="sig_prec">High Precision Entries</span></h3>
                        <p style="margin-bottom: 1rem;" data-i18n="sig_prec_desc">Get real-time entry and exit points
                            directly to your device.</p>
                        <ul style="list-style: none; padding: 0;">
                            <li id="sig-feat-1" style="margin-bottom: 0.5rem;"><i class="fas fa-check-circle"
                                    style="color: var(--primary-color);"></i> <span data-i18n="sig_feat1">Major Forex
                                    Pairs</span></li>
                            <li id="sig-feat-2" style="margin-bottom: 0.5rem;"><i class="fas fa-check-circle"
                                    style="color: var(--primary-color);"></i> <span data-i18n="sig_feat2">Gold &
                                    Indices</span></li>
                            <li id="sig-feat-3" style="margin-bottom: 0.5rem;"><i class="fas fa-check-circle"
                                    style="color: var(--primary-color);"></i> <span data-i18n="sig_feat3">Risk:Reward
                                    1:3
                                    Min</span></li>
                        </ul>
                    </div>
                    <div
                        style="flex: 1; min-width: 300px; background: var(--bg-color); padding: 2rem; border-radius: 10px; border: 1px solid var(--border-color);">
                        <h4 data-i18n="sig_brief">Today's Audio Briefing</h4>
                        <div
                            style="margin-top: 1rem; background: #e2e8f0; padding: 1rem; border-radius: 50px; display: flex; align-items: center; gap: 1rem;">
                            <button
                                style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary-color); border: none; color: white;"><i
                                    class="fas fa-play"></i></button>
                            <div style="height: 4px; flex: 1; background: #cbd5e0; border-radius: 2px;"></div>
                            <span style="font-size: 0.8rem; color: #2d3748;">00:00 / 02:45</span>
                        </div>
                        <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--secondary-color);"
                            data-i18n="sig_brief_desc">Daily market outlook and key levels for EURUSD and XAUUSD.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Statistics Section -->
        <section id="stats" class="stat-section">
            <div class="container">
                <h2 class="section-title" style="color: #fff; border-bottom-color: #fff;"
                    data-i18n="stats_section_title">
                    Platform Activity</h2>
                <div class="stat-grid">
                    <div class="stat-box">
                        <h2>12k+</h2>
                        <p data-i18n="stat_visits">Monthly Visits</p>
                    </div>
                    <div class="stat-box">
                        <h2>850+</h2>
                        <p data-i18n="stat_views">Product Views</p>
                    </div>
                    <div class="stat-box">
                        <h2>300+</h2>
                        <p data-i18n="stat_purchases">Bot Purchases</p>
                    </div>
                    <div class="stat-box">
                        <h2>$1M+</h2>
                        <p data-i18n="stat_profit">Client Profit Generated</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Services & Other Services -->
        <section id="services" class="services-section">
            <div class="container">
                <h2 class="section-title" data-i18n="services_section_title">Services Offered</h2>

                <div class="services-list" style="margin-bottom: 3rem;">
                    <div class="service-badge" data-i18n="serv_custom">Custom Trading Bot Development</div>
                    <div class="service-badge" data-i18n="serv_algo">Algorithmic Strategy Design</div>
                    <div class="service-badge" data-i18n="serv_opt">System Optimization</div>
                    <div class="service-badge" data-i18n="serv_ment">Technical Mentorship</div>
                </div>

                <!-- Other Services Dropdown Placeholder -->
                <div style="max-width: 400px; margin: 0 auto; text-align: center;">
                    <label for="other-services" style="display: block; margin-bottom: 0.5rem; font-weight: 600;"
                        data-i18n="serv_other_label">Other Specialized Services</label>
                    <select id="other-services"
                        style="width: 100%; padding: 1rem; border-radius: 5px; border: 1px solid var(--border-color);">
                        <option value="" data-i18n="serv_select">Select a Service...</option>
                        <option value="cloud">VPS Hosting Setup</option>
                        <option value="data">Historical Data Cleaning</option>
                        <option value="api">Exchange API Integration</option>
                        <option value="consult">Risk Management Audit</option>
                        <option value="custom">Custom Indicator Creation</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Payment Gateways -->
        <section id="payments" class="section">
            <div class="container">
                <h2 class="section-title" data-i18n="pay_title">Secure Payments</h2>
                <div style="display: flex; justify-content: center; gap: 3rem; flex-wrap: wrap; opacity: 0.7;">
                    <!-- Using FontAwesome icons as placeholders for logos -->
                    <i class="fab fa-cc-visa fa-3x"></i>
                    <i class="fab fa-cc-mastercard fa-3x"></i>
                    <i class="fab fa-paypal fa-3x"></i>
                    <i class="fab fa-bitcoin fa-3x"></i>
                    <i class="fab fa-ethereum fa-3x"></i>
                </div>
            </div>
        </section>

        <!-- About Me -->
        <section id="about" class="about-section">
            <div class="container">
                <h2 class="section-title" data-i18n="about_title">About the Developer</h2>
                <div class="about-container">
                    <div style="text-align: center;">
                        <img src="images/profile.png" alt="KRAA MOHAMED" class="profile-img"
                            onerror="this.src='https://ui-avatars.com/api/?name=K+M&background=00ff88&color=fff'">
                        <h3 style="margin-top: 1rem;">KRAA MOHAMED</h3>
                        <p style="color: var(--primary-color); font-weight: 600;" data-i18n="about_role">Senior
                            Algorithmic
                            Trading Developer</p>
                    </div>
                    <div>
                        <h3 data-i18n="about_bio_title">Bio</h3>
                        <p style="margin-bottom: 2rem;" data-i18n="about_bio_text">"To pioneer next-generation
                            algorithmic
                            trading systems that democratize institutional-grade trading tools, making advanced market
                            analysis accessible and actionable for traders worldwide."</p>

                        <h3 data-i18n="about_arsenal_title">Technical Arsenal</h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 2rem;">
                            <span class="service-badge" style="padding: 0.5rem 1rem; font-size: 0.8rem;">Python</span>
                            <span class="service-badge" style="padding: 0.5rem 1rem; font-size: 0.8rem;">MQL4/5</span>
                            <span class="service-badge" style="padding: 0.5rem 1rem; font-size: 0.8rem;">C++</span>
                            <span class="service-badge" style="padding: 0.5rem 1rem; font-size: 0.8rem;">AWS</span>
                            <span class="service-badge" style="padding: 0.5rem 1rem; font-size: 0.8rem;">Docker</span>
                            <span class="service-badge" style="padding: 0.5rem 1rem; font-size: 0.8rem;">Pandas</span>
                        </div>

                        <h3 data-i18n="about_exp_title">Professional Experience</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-date">2020 - Present</div>
                                <h4 data-i18n="exp_role1">Algorithmic Trading Consultant</h4>
                                <p>FinTech Solutions Ltd.</p>
                                <ul
                                    style="font-size: 0.9rem; margin-top: 0.5rem; list-style: disc; padding-left: 1rem;">
                                    <li data-i18n="exp_desc1a">Deployed 15+ proprietary algorithms (78% success rate).
                                    </li>
                                    <li data-i18n="exp_desc1b">Reduced latency by 40% via architecture optimization.
                                    </li>
                                </ul>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">2017 - 2020</div>
                                <h4 data-i18n="exp_role2">Senior MQL5 Developer</h4>
                                <p>Quantitative Edge</p>
                                <ul
                                    style="font-size: 0.9rem; margin-top: 0.5rem; list-style: disc; padding-left: 1rem;">
                                    <li data-i18n="exp_desc2a">Led migration from MQL4 to MQL5 for 200+ clients.</li>
                                    <li data-i18n="exp_desc2b">Implemented efficient backtesting frameworks.</li>
                                </ul>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-date">2014 - 2017</div>
                                <h4 data-i18n="exp_role3">Trading Systems Analyst</h4>
                                <p>Capital Markets Group</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Us -->
        <section id="contact" class="contact-section">
            <div class="container">
                <h2 class="section-title" data-i18n="contact_title">Get In Touch</h2>
                <form class="contact-form">
                    <div class="form-group">
                        <input type="text" placeholder="Your Name" required data-i18n-placeholder="form_name">
                    </div>
                    <div class="form-group">
                        <input type="email" placeholder="Your Email" required data-i18n-placeholder="form_email">
                    </div>
                    <div class="form-group">
                        <textarea rows="5" placeholder="Your Message" required
                            data-i18n-placeholder="form_msg"></textarea>
                    </div>
                    <button type="submit" class="btn-primary" data-i18n="form_send">Send Message</button>
                </form>

                <div style="text-align: center; margin-top: 3rem;">
                    <p style="margin-bottom: 1rem;" data-i18n="follow_us">Follow us on social media:</p>
                    <div style="display: flex; justify-content: center; gap: 1.5rem;">
                        <a href="https://www.facebook.com/jamal.duer.5" target="_blank" style="font-size: 1.5rem;"><i
                                class="fab fa-facebook"></i></a>
                        <a href="mailto:bachasalman69@gmail.com" style="font-size: 1.5rem;"><i
                                class="fas fa-envelope"></i></a>
                        <a href="https://www.pinterest.com/taybegames1981/" target="_blank"
                            style="font-size: 1.5rem;"><i class="fab fa-pinterest"></i></a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Placeholder for Dynamic Sections Rendered via JS -->
    </main>

    <!-- Admin Quick Access -->
    <section id="admin-quick-access"
        style="display: none; padding: 5rem 0; background: var(--bg-color); border-top: 2px dashed var(--primary-color);">
        <div class="container" style="text-align: center;">
            <h2 class="section-title" style="color: var(--primary-color);"><i class="fas fa-user-shield"></i> Admin
                Control Center</h2>
            <div
                style="max-width: 600px; margin: 0 auto; background: var(--card-bg); padding: 2.5rem; border-radius: 15px; border: 1px solid var(--border-color); box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                <p style="margin-bottom: 2rem; font-size: 1.1rem; opacity: 0.9;">Welcome back! This section is
                    <strong>hidden</strong> from your visitors and only appears because you are logged in.
                </p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <button onclick="openAdmin()" class="btn-primary" style="padding: 1rem;">
                        <i class="fas fa-tasks"></i> Open Dashboard
                    </button>
                    <button onclick="logoutAdmin()" class="btn"
                        style="border: 1px solid #ff4d4d; color: #ff4d4d; padding: 1rem;">
                        <i class="fas fa-sign-out-alt"></i> Logout Admin
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer
        style="background: var(--bg-color); border-top: 1px solid var(--border-color); padding: 2rem 0; text-align: center; font-size: 0.9rem;">
        <div class="container"
            style="display:flex; justify-content:center; align-items:center; gap:1rem; flex-wrap:wrap;">
            <p onclick="triggerAdmin()" style="cursor:text; user-select:none;">&copy; 2025 <span
                    class="site-title-rendered">Trading Made Easy</span>. <span data-i18n="rights_reserved">All
                    rights
                    reserved.</span></p>
        </div>
    </footer>

    <!-- Admin Panel Overlay (Internal Page) -->
    <div id="admin-overlay"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg-color); z-index:9999; overflow-y:auto; padding:2rem;">
        <div class="container" style="max-width:800px; margin:0 auto;">
            <div
                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:3rem; border-bottom:1px solid var(--border-color); padding-bottom:1rem;">
                <div>
                    <h1 style="margin:0; font-size:2rem; color:var(--primary-color);" data-i18n="adm_dashboard_title">
                        Admin Dashboard</h1>
                    <p style="margin:0; opacity:0.7;" data-i18n="adm_dashboard_desc">Manage your website content and
                        settings</p>
                </div>
                <button onclick="closeAdmin()" class="btn"
                    style="border:1px solid var(--text-color); padding:0.5rem 1.5rem;" data-i18n="adm_exit_btn">Exit
                    Dashboard</button>
            </div>

            <!-- Auth Screen -->
            <div id="admin-auth" style="text-align:center; padding-top:2rem;">
                <h3 data-i18n="adm_enter_pass">Enter Developer Password</h3>
                <input type="password" id="admin-pass-input" placeholder="Password"
                    data-i18n-placeholder="adm_pass_placeholder"
                    style="padding:1rem; width:100%; max-width:300px; margin:1rem 0; background:var(--card-bg); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                <br>
                <button onclick="verifyAdmin()" class="btn-primary" style="width:100%; max-width:300px;"
                    data-i18n="adm_login_btn">Login</button>
                <p id="auth-error" style="color:#e53e3e; margin-top:1rem; display:none;" data-i18n="adm_error_pass">
                    Incorrect Password</p>
            </div>

            <!-- Controls (Hidden until Auth) -->
            <div id="admin-controls" style="display:none;">

                <!-- Tabs Navigation -->
                <div
                    style="display:flex; gap:1rem; margin-bottom:2rem; border-bottom:1px solid var(--border-color); padding-bottom:1rem;">
                    <button onclick="switchTab('general')" class="btn" id="tab-btn-general" style="opacity:1;"
                        data-i18n="adm_tab_general">General</button>
                    <button onclick="switchTab('appearance')" class="btn" id="tab-btn-appearance" style="opacity:0.6;"
                        data-i18n="adm_tab_appearance">Appearance</button>
                    <button onclick="switchTab('content')" class="btn" id="tab-btn-content" style="opacity:0.6;"
                        data-i18n="adm_tab_content">Content
                        & Products</button>
                    <button onclick="switchTab('sections')" class="btn" id="tab-btn-sections" style="opacity:0.6;"><i
                            class="fas fa-layer-group"></i> Sections Order</button>
                </div>

                <!-- Tab: General -->
                <div id="tab-general">
                    <div class="admin-card"
                        style="background:var(--card-bg); padding:2rem; border-radius:10px; margin-bottom:2rem; border:1px solid var(--border-color);">

                        <!-- Moved Section Visibility to new tab for granular control, keeping legacy checkboxes for compatibility if needed, but hiding them to avoid confusion -->
                        <div style="display:none;">
                            <!-- Legacy Visibility Controls Hidden -->
                        </div>

                        <h3 style="margin: 0 0 1rem;" data-i18n="adm_social_title"><i class="fas fa-share-alt"></i>
                            Social & Contact Links</h3>
                        <div style="display:grid; gap:1rem;">
                            <div>
                                <label style="display:block; font-size:0.8rem; opacity:0.7;">Facebook URL</label>
                                <input type="text" id="adm-link-fb"
                                    style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                            </div>
                            <div>
                                <label style="display:block; font-size:0.8rem; opacity:0.7;">Pinterest URL</label>
                                <input type="text" id="adm-link-pin"
                                    style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                            </div>
                            <div>
                                <label style="display:block; font-size:0.8rem; opacity:0.7;">Contact Email</label>
                                <input type="text" id="adm-link-email"
                                    style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                            </div>
                        </div>

                        <h3 style="margin: 1.5rem 0 1rem;" data-i18n="adm_wallet_title"><i class="fas fa-wallet"></i>
                            Payment Wallets (Checkout)</h3>
                        <div style="display:grid; gap:1rem;">
                            <div>
                                <label style="display:block; font-size:0.8rem; opacity:0.7;">USDT (TRC20)
                                    Address</label>
                                <input type="text" id="adm-wallet-usdt" placeholder="TR7NHqj..."
                                    style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                            </div>
                            <div>
                                <label style="display:block; font-size:0.8rem; opacity:0.7;">Litecoin (LTC)
                                    Address</label>
                                <input type="text" id="adm-wallet-ltc" placeholder="LM2nyQ..."
                                    style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                            </div>
                            <div>
                                <label style="display:block; font-size:0.8rem; opacity:0.7;">Payeer Account
                                    ID</label>
                                <input type="text" id="adm-wallet-payeer" placeholder="P1000..."
                                    style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Sections Manager (New) -->
                <div id="tab-sections" style="display:none;">
                    <div class="admin-card"
                        style="background:var(--card-bg); padding:2rem; border-radius:10px; margin-bottom:2rem; border:1px solid var(--border-color);">
                        <h3 style="margin-bottom:1rem;"><i class="fas fa-sort"></i> Reorder & Hide Page Sections
                        </h3>
                        <p style="font-size:0.9rem; opacity:0.8; margin-bottom:1.5rem;">Drag and drop or use buttons
                            to
                            reorder sections. Toggle the eye icon to hide/show them.</p>

                        <div id="sections-list-editor" style="display:flex; flex-direction:column; gap:0.8rem;">
                            <!-- Populated by JS -->
                        </div>
                        <button onclick="refreshSectionList()" class="btn" style="margin-top:1rem; font-size:0.8rem;"><i
                                class="fas fa-sync"></i> Refresh
                            List</button>

                        <!-- NEW: Add Custom Section Form -->
                        <div
                            style="margin-top:2.5rem; border-top:2px solid var(--border-color); padding-top:1.5rem; background:rgba(0,255,136,0.05); padding:1.5rem; border-radius:10px;">
                            <h4 style="margin-bottom:1rem; display:flex; align-items:center; gap:0.5rem;"><i
                                    class="fas fa-plus-square"></i> Add New Dynamic Section</h4>
                            <div style="display:grid; gap:1rem;">
                                <div style="display:grid; grid-template-columns:1fr 1fr; gap:1rem;">
                                    <div>
                                        <label style="display:block; font-size:0.8rem; margin-bottom:0.3rem;">Element
                                            Title</label>
                                        <input type="text" id="new-sec-title" placeholder="e.g. Courses Tab"
                                            style="width:100%; padding:0.6rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                                    </div>
                                    <div>
                                        <label
                                            style="display:block; font-size:0.8rem; margin-bottom:0.3rem;">Placement</label>
                                        <select id="new-sec-placement"
                                            style="width:100%; padding:0.6rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                                            <option value="body">Main Page Section</option>
                                            <option value="navbar">Top Navigation Bar</option>
                                            <option value="sidebar-left">Sidebar (Left)</option>
                                            <option value="sidebar-right">Sidebar (Right)</option>
                                            <option value="footer">Footer Area</option>
                                        </select>
                                    </div>
                                </div>
                                <div style="display:grid; grid-template-columns:1fr 1fr; gap:1rem;">
                                    <div>
                                        <label
                                            style="display:block; font-size:0.8rem; margin-bottom:0.3rem;">Alignment</label>
                                        <select id="new-sec-align"
                                            style="width:100%; padding:0.6rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                                            <option value="center">Center</option>
                                            <option value="left">Left</option>
                                            <option value="right">Right</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="display:block; font-size:0.8rem; margin-bottom:0.3rem;">Icon
                                            (FontAwesome)</label>
                                        <input type="text" id="new-sec-icon" placeholder="fas fa-star"
                                            style="width:100%; padding:0.6rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                                    </div>
                                </div>
                                <div>
                                    <label style="display:block; font-size:0.8rem; margin-bottom:0.3rem;">Content (Text,
                                        HTML, or Link URL if Navbar)</label>
                                    <textarea id="new-sec-content" rows="3"
                                        placeholder="Type content or paste URL here..."
                                        style="width:100%; padding:0.6rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;"></textarea>
                                </div>
                                <button onclick="addCustomSection(event)" class="btn-primary" style="width:100%;">
                                    <i class="fas fa-plus-circle"></i> Create Section
                                </button>
                            </div>

                            <!-- List was here, moved to Content Tab for better organization -->
                        </div>
                    </div>
                </div>

                <!-- Tab: Appearance -->
                <div id="tab-appearance" style="display:none;">
                    <div class="admin-card"
                        style="background:var(--card-bg); padding:2rem; border-radius:10px; margin-bottom:2rem; border:1px solid var(--border-color);">
                        <h3 style="margin-bottom:1.5rem;"><i class="fas fa-palette"></i> Look & Feel</h3>

                        <div style="margin-bottom:1.5rem;">
                            <label style="display:block; margin-bottom:0.5rem; font-weight:600;"
                                data-i18n="adm_app_title_label">Site Title</label>
                            <input type="text" id="adm-app-title"
                                style="width:100%; padding:0.8rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                        </div>

                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1.5rem; margin-bottom:1.5rem;">
                            <div>
                                <label style="display:block; margin-bottom:0.5rem; font-weight:600;"
                                    data-i18n="adm_app_color_label">Primary
                                    Color</label>
                                <input type="color" id="adm-app-color" style="width:100%; height:50px; cursor:pointer;"
                                    value="#00ff88">
                            </div>
                            <div>
                                <label style="display:block; margin-bottom:0.5rem; font-weight:600;"
                                    data-i18n="adm_app_radius_label">Corner
                                    Style</label>
                                <select id="adm-app-radius"
                                    style="width:100%; padding:0.8rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                                    <option value="10px">Rounded (Default)</option>
                                    <option value="0px">Sharp</option>
                                    <option value="20px">Extra Rounded</option>
                                </select>
                            </div>
                        </div>

                        <div style="margin-bottom:1.5rem;">
                            <label style="display:block; margin-bottom:0.5rem; font-weight:600;"
                                data-i18n="adm_app_meta_label">SEO Meta
                                Description</label>
                            <textarea id="adm-app-meta" rows="2"
                                style="width:100%; padding:0.8rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;"
                                placeholder="Short description for Google search results..."></textarea>
                        </div>

                        <div>
                            <label style="display:block; margin-bottom:0.5rem; font-weight:600;"
                                data-i18n="adm_app_profile_label">Profile Picture (About
                                Me)</label>
                            <div style="display:flex; gap:1rem; align-items:center;">
                                <input type="file" id="adm-app-profile-file" accept="image/*" style="display:none;"
                                    onchange="previewProfileImg(this)">
                                <button onclick="document.getElementById('adm-app-profile-file').click()" class="btn"
                                    style="padding:0.5rem 1rem; border:1px solid var(--border-color);"
                                    data-i18n="adm_app_upload_btn">
                                    <i class="fas fa-upload"></i> Upload New Photo
                                </button>
                                <div id="profile-img-preview"
                                    style="width:50px; height:50px; border-radius:50%; border:1px solid var(--border-color); background:center/cover no-repeat; display:none;">
                                </div>
                                <input type="hidden" id="adm-app-profile-base64">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab: Content -->
                <div id="tab-content" style="display:none;">

                    <!-- Text Edits -->
                    <div class="admin-card"
                        style="background:var(--card-bg); padding:2rem; border-radius:10px; margin-bottom:2rem; border:1px solid var(--border-color);">
                        <h3 style="margin-bottom:1.5rem;" data-i18n="adm_tab_content">Text Customization</h3>
                        <div style="margin-bottom:1rem;">
                            <label style="display:block; margin-bottom:0.5rem;" data-i18n="adm_txt_hero_label">Hero
                                Title</label>
                            <input type="text" id="adm-txt-hero"
                                style="width:100%; padding:0.8rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                        </div>
                        <div style="margin-bottom:1rem;">
                            <label style="display:block; margin-bottom:0.5rem;" data-i18n="adm_txt_hero_desc_label">Hero
                                Description</label>
                            <textarea id="adm-txt-hero-desc" rows="2"
                                style="width:100%; padding:0.8rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;"></textarea>
                        </div>
                        <div style="margin-bottom:1rem;">
                            <label style="display:block; margin-bottom:0.5rem;" data-i18n="adm_txt_about_label">About
                                Bio (Professional Summary)</label>
                            <div style="margin-bottom:1rem;">
                                <label style="display:block; margin-bottom:0.5rem;"
                                    data-i18n="adm_txt_about_label">About
                                    Bio (Professional Summary)</label>
                                <textarea id="adm-txt-about" rows="3"
                                    style="width:100%; padding:0.8rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;"></textarea>
                            </div>

                            <div style="margin-bottom:1rem;">
                                <label style="display:block; margin-bottom:0.5rem;">About Me Role</label>
                                <input type="text" id="adm-txt-about-role"
                                    style="width:100%; padding:0.8rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;">
                            </div>

                            <!-- NEW: Navigation Links Editor -->
                            <div style="margin-top:2rem; border-top:1px dashed var(--border-color); padding-top:1rem;">
                                <h4 style="margin-bottom:1rem; opacity:0.8;">Navigation Menu Labels (Visibility)
                                </h4>
                                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                                    <div>
                                        <div style="display:flex; justify-content:space-between; font-size:0.75rem;">
                                            <label>Home</label><input type="checkbox" id="adm-vis-nav-home">
                                        </div><input type="text" id="adm-nav-home" placeholder="Home"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <div style="display:flex; justify-content:space-between; font-size:0.75rem;">
                                            <label>Bots</label><input type="checkbox" id="adm-vis-nav-bots">
                                        </div><input type="text" id="adm-nav-bots" placeholder="MT5 Bots"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <div style="display:flex; justify-content:space-between; font-size:0.75rem;">
                                            <label>Signals</label><input type="checkbox" id="adm-vis-nav-signals">
                                        </div>
                                        <input type="text" id="adm-nav-signals" placeholder="Signals"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <div style="display:flex; justify-content:space-between; font-size:0.75rem;">
                                            <label>Services</label><input type="checkbox" id="adm-vis-nav-services">
                                        </div><input type="text" id="adm-nav-services" placeholder="Services"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <div style="display:flex; justify-content:space-between; font-size:0.75rem;">
                                            <label>About</label><input type="checkbox" id="adm-vis-nav-about">
                                        </div>
                                        <input type="text" id="adm-nav-about" placeholder="About"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <div style="display:flex; justify-content:space-between; font-size:0.75rem;">
                                            <label>Contact</label><input type="checkbox" id="adm-vis-nav-contact">
                                        </div>
                                        <input type="text" id="adm-nav-contact" placeholder="Contact"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                </div>
                            </div>

                            <!-- NEW: Offers and Details with VISIBILITY -->
                            <div style="margin-top:2rem; border-top:1px dashed var(--border-color); padding-top:1rem;">
                                <h4 style="margin-bottom:1rem; opacity:0.8;">Offers & Section Details (Visibility
                                    Control)</h4>

                                <div style="margin-bottom:1rem;">
                                    <div style="display:flex; justify-content:space-between;">
                                        <label style="font-size:0.8rem;">Latest Offer Text (Hero)</label>
                                        <label style="font-size:0.8rem;"><input type="checkbox" id="adm-vis-offer">
                                            Show</label>
                                    </div>
                                    <input type="text" id="adm-txt-offer-text"
                                        style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                </div>

                                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                                    <div>
                                        <div style="display:flex; justify-content:space-between;"><label
                                                style="font-size:0.7rem;">Signal Feature 1</label><input type="checkbox"
                                                id="adm-vis-sig1"></div>
                                        <input type="text" id="adm-sig-feat1"
                                            style="width:100%; padding:0.4rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <div style="display:flex; justify-content:space-between;"><label
                                                style="font-size:0.7rem;">Signal Feature 2</label><input type="checkbox"
                                                id="adm-vis-sig2"></div>
                                        <input type="text" id="adm-sig-feat2"
                                            style="width:100%; padding:0.4rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <div style="display:flex; justify-content:space-between;"><label
                                                style="font-size:0.7rem;">Signal Feature 3</label><input type="checkbox"
                                                id="adm-vis-sig3"></div>
                                        <input type="text" id="adm-sig-feat3"
                                            style="width:100%; padding:0.4rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <div style="display:flex; justify-content:space-between;"><label
                                                style="font-size:0.7rem;">Stats: Success Rate</label><input
                                                type="checkbox" id="adm-vis-stat1"></div>
                                        <input type="text" id="adm-stat-success"
                                            style="width:100%; padding:0.4rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                </div>
                            </div>

                            <!-- NEW: Section Titles -->
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem; margin-top:1.5rem;">
                                <h4 style="grid-column:1/-1; margin-bottom:0.5rem; opacity:0.8;">Section Headings
                                </h4>
                                <div>
                                    <label style="display:block; font-size:0.8rem; margin-bottom:0.3rem;">Bots
                                        Section</label>
                                    <input type="text" id="adm-txt-bots-title"
                                        style="width:100%; padding:0.5rem; border-radius:5px; border:1px solid var(--border-color); background:var(--bg-color); color:var(--text-color);">
                                </div>
                                <div>
                                    <label style="display:block; font-size:0.8rem; margin-bottom:0.3rem;">Signals
                                        Section</label>
                                    <input type="text" id="adm-txt-signals-title"
                                        style="width:100%; padding:0.5rem; border-radius:5px; border:1px solid var(--border-color); background:var(--bg-color); color:var(--text-color);">
                                </div>
                                <div>
                                    <label style="display:block; font-size:0.8rem; margin-bottom:0.3rem;">Services
                                        Section</label>
                                    <input type="text" id="adm-txt-services-title"
                                        style="width:100%; padding:0.5rem; border-radius:5px; border:1px solid var(--border-color); background:var(--bg-color); color:var(--text-color);">
                                </div>
                                <div>
                                    <label style="display:block; font-size:0.8rem; margin-bottom:0.3rem;">Stats
                                        Section</label>
                                    <input type="text" id="adm-txt-stats-title"
                                        style="width:100%; padding:0.5rem; border-radius:5px; border:1px solid var(--border-color); background:var(--bg-color); color:var(--text-color);">
                                </div>
                                <div>
                                    <label style="display:block; font-size:0.8rem; margin-bottom:0.3rem;">Payments
                                        Section</label>
                                    <input type="text" id="adm-txt-pay-title"
                                        style="width:100%; padding:0.5rem; border-radius:5px; border:1px solid var(--border-color); background:var(--bg-color); color:var(--text-color);">
                                </div>
                                <div>
                                    <label style="display:block; font-size:0.8rem; margin-bottom:0.3rem;">Contact
                                        Section</label>
                                    <input type="text" id="adm-txt-contact-title"
                                        style="width:100%; padding:0.5rem; border-radius:5px; border:1px solid var(--border-color); background:var(--bg-color); color:var(--text-color);">
                                </div>
                            </div>

                            <div style="margin-top:2rem;">
                                <h4 style="margin-bottom:0.5rem;">Specific Text Overrides</h4>
                                <div style="display:grid; grid-template-columns: 1fr; gap:1rem;">
                                    <div>
                                        <label style="font-size:0.8rem;">Hero Suffix (Automated...)</label>
                                        <input type="text" id="adm-txt-hero-suffix"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <label style="font-size:0.8rem;">Bots Subtitle (Discover our
                                            range...)</label>
                                        <input type="text" id="adm-txt-bots-sub"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <label style="font-size:0.8rem;">Services Badge 1 (Custom Bot...)</label>
                                        <input type="text" id="adm-txt-serv-1"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <label style="font-size:0.8rem;">Services Badge 2</label>
                                        <input type="text" id="adm-txt-serv-2"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <label style="font-size:0.8rem;">Services Badge 3</label>
                                        <input type="text" id="adm-txt-serv-3"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <label style="font-size:0.8rem;">Services Badge 4</label>
                                        <input type="text" id="adm-txt-serv-4"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>

                                    <div
                                        style="grid-column: 1/-1; margin-top:1rem; border-top:1px dashed var(--border-color); padding-top:1rem;">
                                        <h5 style="margin-bottom:0.5rem;"><i class="fas fa-bullhorn"></i> Latest
                                            Signal
                                            (Briefing)</h5>
                                        <input type="text" id="adm-txt-sig-brief-title"
                                            placeholder="Briefing Title (e.g. Today's Outlook)"
                                            style="width:100%; margin-bottom:0.5rem; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                        <input type="text" id="adm-txt-sig-brief-desc"
                                            placeholder="Briefing Detail (e.g. Gold hitting resistance...)"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top:2rem;">
                                <h4 style="margin-bottom:0.5rem;" data-i18n="adm_txt_ticker_label"><i
                                        class="fas fa-broadcast-tower"></i> News Ticker
                                    Messages</h4>
                                <p style="font-size:0.75rem; opacity:0.7; margin-bottom:0.5rem;"
                                    data-i18n="adm_txt_ticker_desc">Enter one message per line.
                                    These rotate at the top of the site.</p>
                                <textarea id="adm-txt-ticker" rows="4"
                                    style="width:100%; padding:0.8rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:5px;"
                                    placeholder="Welcome to our platform...&#10;New bot release coming soon..."></textarea>
                            </div>
                            <!-- NEW: Placeholder for Custom Sections Text Edits -->
                            <div id="custom-sections-text-edits"
                                style="margin-top:2rem; border-top:1px solid var(--border-color); padding-top:1.5rem;">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <!-- Products Manager -->
                        <div class="admin-card"
                            style="background:var(--card-bg); padding:2rem; border-radius:10px; margin-bottom:2rem; border:1px solid var(--border-color);">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
                                <h3 style="margin:0;" data-i18n="adm_prod_manage_title">Manage Products (Bots)</h3>
                                <button onclick="loadSettings()" class="btn"
                                    style="font-size:0.7rem; padding:0.3rem 0.6rem; opacity:0.7;"
                                    data-i18n="adm_prod_refresh"><i class="fas fa-sync"></i> Refresh List</button>
                            </div>

                            <div id="adm-prod-list" style="margin-bottom:1.5rem; display:grid; gap:0.5rem;">
                                <!-- Filled via JS -->
                            </div>

                            <div id="db-inspector"
                                style="margin-bottom:1.5rem; font-family:monospace; font-size:0.7rem; background:#000; padding:0.5rem; border-radius:5px; color:#0f0; max-height:150px; overflow:auto; display:none;">
                                <!-- Debug JSON here -->
                            </div>
                            <button
                                onclick="document.getElementById('db-inspector').style.display='block'; document.getElementById('db-inspector').textContent = JSON.stringify(currentProducts, null, 2);"
                                class="btn" style="font-size:0.6rem; opacity:0.5;">Show Raw Data (Debug)</button>

                            <div
                                style="background:rgba(255,170,0,0.1); padding:1rem; border-radius:5px; border:1px dashed #ffaa00; margin-bottom:1.5rem;">
                                <h4 style="color:#ffaa00; margin-top:0;"><i class="fas fa-exclamation-triangle"></i>
                                    Cloud
                                    Control</h4>
                                <p style="font-size:0.8rem; opacity:0.8;">If you see products on the site but not
                                    here,
                                    use
                                    the button below to wipe the cloud database and start fresh.</p>
                                <button onclick="clearCloudDatabase()" class="btn"
                                    style="background:#ff4d4d; color:white; border:none; padding:0.5rem 1rem; font-size:0.8rem; margin-top:0.5rem;">
                                    <i class="fas fa-eraser"></i> Force Wipe Cloud Database
                                </button>
                            </div>

                            <div
                                style="background:var(--bg-color); padding:1rem; border-radius:5px; border:1px solid var(--border-color);">
                                <div
                                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                                    <h4 style="margin:0;" id="adm-prod-form-title" data-i18n="adm_prod_add_title">
                                        Add
                                        New
                                        Product</h4>
                                    <button id="cancel-edit-btn" onclick="cancelProductEdit()" class="btn"
                                        style="display:none; background:#666; font-size:0.7rem; padding:0.2rem 0.5rem;">Cancel
                                        Edit</button>
                                </div>
                                <div
                                    style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.8rem; background:rgba(0,208,156,0.1); padding:0.5rem; border-radius:5px; border:1px solid var(--primary-color);">
                                    <label style="font-size:0.85rem; font-weight:600; cursor:pointer;"
                                        data-i18n="adm_prod_type_free">Free Product?</label>
                                    <input type="checkbox" id="new-prod-is-free"
                                        onchange="togglePriceField(this.checked)">
                                </div>
                                <input type="text" id="new-prod-title" placeholder="Product Title"
                                    data-i18n-placeholder="adm_prod_title_placeholder"
                                    style="width:100%; margin-bottom:0.5rem; padding:0.5rem; background:var(--card-bg); color:var(--text-color); border:1px solid var(--border-color);">
                                <div style="display:flex; gap:0.5rem; margin-bottom:0.5rem; align-items:center;">
                                    <div id="price-field-wrapper" style="width:30%;">
                                        <input type="text" id="new-prod-price" placeholder="Price ($)"
                                            data-i18n-placeholder="adm_prod_price_placeholder"
                                            style="width:100%; padding:0.5rem; background:var(--card-bg); color:var(--text-color); border:1px solid var(--border-color);">
                                    </div>
                                    <div style="width:70%; display:flex; gap:0.5rem; align-items:center;">
                                        <input type="file" id="new-prod-img-file" accept="image/*" style="display:none;"
                                            onchange="previewImage(this)">
                                        <button onclick="document.getElementById('new-prod-img-file').click()"
                                            class="btn"
                                            style="flex:1; padding:0.5rem; font-size:0.8rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color);"
                                            data-i18n="adm_prod_img_btn">
                                            <i class="fas fa-image"></i> Choose Image
                                        </button>
                                        <div id="img-preview-box"
                                            style="width:40px; height:40px; border:1px solid var(--border-color); border-radius:5px; background:center/cover no-repeat; display:none;">
                                        </div>
                                    </div>
                                    <input type="hidden" id="new-prod-img-base64">
                                </div>
                                <textarea id="new-prod-desc" placeholder="Short Description"
                                    data-i18n-placeholder="adm_prod_desc_placeholder"
                                    style="width:100%; margin-bottom:0.5rem; padding:0.5rem; background:var(--card-bg); color:var(--text-color); border:1px solid var(--border-color);"
                                    rows="2"></textarea>

                                <!-- Downloadable File Field -->
                                <div
                                    style="background:rgba(0,0,0,0.1); padding:0.8rem; border-radius:5px; margin-bottom:1rem; border:1px dashed var(--border-color);">
                                    <label
                                        style="display:block; font-size:0.8rem; margin-bottom:0.5rem; font-weight:600;"
                                        data-i18n="adm_file_label"><i class="fas fa-file-archive"></i> Product
                                        Download
                                        File
                                        (.zip, .rar,
                                        etc.)</label>
                                    <div style="display:flex; gap:0.5rem; align-items:center;">
                                        <input type="file" id="new-prod-file-input" style="display:none;"
                                            onchange="handleProductFile(this)">
                                        <button onclick="document.getElementById('new-prod-file-input').click()"
                                            class="btn"
                                            style="padding:0.5rem; font-size:0.8rem; border:1px solid var(--border-color); background:var(--bg-color); color:var(--text-color);"
                                            data-i18n="adm_file_btn">
                                            <i class="fas fa-upload"></i> Choose/Update File
                                        </button>
                                        <button id="remove-file-btn" onclick="removeProductFile()" class="btn"
                                            style="padding:0.5rem; font-size:0.8rem; border:1px solid #ff4d4d; background:rgba(255,77,77,0.1); color:#ff4d4d; display:none;"
                                            data-i18n="adm_file_remove">
                                            <i class="fas fa-trash"></i> Remove File
                                        </button>
                                        <span id="file-name-display" style="font-size:0.8rem; opacity:0.7;"
                                            data-i18n="adm_file_none">No file
                                            selected</span>
                                        <input type="hidden" id="new-prod-file-data">
                                        <input type="hidden" id="new-prod-file-name">
                                    </div>
                                </div>

                                <button id="add-prod-btn" onclick="addNewProduct()" class="btn-primary"
                                    style="width:100%; padding:0.8rem; font-size:0.9rem; font-weight:bold; margin-top:0.5rem;"
                                    data-i18n="adm_prod_add_btn">
                                    <i class="fas fa-plus-circle"></i> Add Product to Website
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Global Save -->
                    <div
                        style="position:sticky; bottom:1rem; background:var(--card-bg); padding:1rem; border-top:1px solid var(--border-color); border-radius:10px; box-shadow:0 -5px 20px rgba(0,0,0,0.2); display:flex; justify-content:flex-end;">
                        <button id="final-save-btn" onclick="saveSettings(true);" class="btn-primary"
                            style="width:200px;" data-i18n="adm_save_all">Save All Changes</button>
                    </div>

                </div>
            </div>
        </div>

        <!-- Scripts -->
        <script src="script.js"></script>
        <script>
            // --- Admin Logic ---

            // Toggle Admin Quick Access Section Visibility
            function updateAdminUI() {
                const adminSection = document.getElementById('admin-quick-access');
                if (adminSection) {
                    const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true'; // Persistent login
                    adminSection.style.display = isLoggedIn ? 'block' : 'none';
                }
            }

            // Trigger (Simplified to 1 click as requested)
            function triggerAdmin() {
                openAdmin();
            }

            // Open/Close
            function openAdmin() {
                document.getElementById('admin-overlay').style.display = 'block';
                document.body.style.overflow = 'hidden';

                // Re-load settings to ensure products are ready
                loadSettings();

                // Check if already logged in
                if (localStorage.getItem('adminLoggedIn') === 'true') {
                    updateAdminUI();
                    document.getElementById('admin-auth').style.display = 'none';
                    document.getElementById('admin-controls').style.display = 'block';
                    // DEFAULT TO CONTENT TAB as requested to show products immediately
                    switchTab('content');
                }
            }

            function closeAdmin() {
                document.getElementById('admin-overlay').style.display = 'none';
                document.body.style.overflow = 'auto';
                location.reload(); // Reload to apply changes
            }

            // Auth
            function verifyAdmin() {
                const pass = document.getElementById('admin-pass-input').value;
                if (pass === 'admin123') {
                    localStorage.setItem('adminLoggedIn', 'true'); // Persist globally
                    updateAdminUI();
                    document.getElementById('admin-auth').style.display = 'none';
                    document.getElementById('admin-controls').style.display = 'block';
                    loadSettings();
                } else {
                    document.getElementById('auth-error').style.display = 'block';
                }
            }

            function logoutAdmin() {
                localStorage.removeItem('adminLoggedIn');
                location.reload();
            }

            // Run UI check on load
            document.addEventListener('DOMContentLoaded', updateAdminUI);

            // Settings Logic - V2
            // CONFIG_KEY is already defined globally at the top
            let editingIndex = -1;
            console.log('Admin ready to manage cloud products');

            function switchTab(tab) {
                ['general', 'appearance', 'content', 'sections'].forEach(t => {
                    const contentDiv = document.getElementById('tab-' + t);
                    const btn = document.getElementById('tab-btn-' + t);

                    if (contentDiv) contentDiv.style.display = (t === tab) ? 'block' : 'none';
                    if (btn) btn.style.opacity = (t === tab) ? '1' : '0.6';
                });

                if (tab === 'content') renderProductList();
                if (tab === 'sections') {
                    if (typeof refreshSectionList === 'function') refreshSectionList();
                    if (typeof refreshCustomSectionsList === 'function') refreshCustomSectionsList();
                }
            }

            function loadSettings() {
                try {
                    const config = JSON.parse(localStorage.getItem(CONFIG_KEY)) || { visibility: {}, textOverrides: {}, appearance: {}, products: [] };
                    console.log('--- loadSettings Started ---', config);

                    const setVal = (id, val) => {
                        const el = document.getElementById(id);
                        if (el) el.value = val || '';
                    };
                    const setCheck = (id, val) => {
                        const el = document.getElementById(id);
                        if (el) el.checked = val !== false;
                    };

                    // Visibility
                    setCheck('adm-vis-bots', config.visibility.bots);
                    setCheck('adm-vis-signals', config.visibility.signals);
                    setCheck('adm-vis-services', config.visibility.services);
                    setCheck('adm-vis-about', config.visibility.about);

                    // Appearance
                    const app = config.appearance || {};
                    setVal('adm-app-title', app.siteTitle || "Trading Made Easy");
                    setVal('adm-app-color', app.primaryColor || "#00ff88");
                    setVal('adm-app-radius', app.borderRadius || "10px");

                    // Texts
                    const txt = config.textOverrides || {};
                    setVal('adm-txt-hero', txt.hero_title || "Precision Trading. Automated.");
                    setVal('adm-txt-hero-desc', txt.hero_desc || "A platform dedicated to...");
                    setVal('adm-txt-about', txt.about_bio || "");
                    setVal('adm-txt-ticker', txt.ticker_msgs || "");

                    // New Section Titles
                    setVal('adm-txt-bots-title', txt.bots_title || "Premium MT5 Bots");
                    setVal('adm-txt-signals-title', txt.signals_title || "Daily Trading Signals");
                    setVal('adm-txt-services-title', txt.services_title || "Services Offered");
                    setVal('adm-txt-stats-title', txt.stats_title || "Platform Activity");
                    setVal('adm-txt-pay-title', txt.pay_title || "Secure Payments");
                    setVal('adm-txt-contact-title', txt.contact_title || "Get In Touch");

                    // Detailed Overrides Load
                    setVal('adm-txt-about-role', txt.about_role || "");
                    setVal('adm-nav-home', txt.nav_home || "Home");
                    setVal('adm-nav-bots', txt.nav_bots || "MT5 Bots");
                    setVal('adm-nav-signals', txt.nav_signals || "Signals");
                    setVal('adm-nav-services', txt.nav_services || "Services");
                    setVal('adm-nav-about', txt.nav_about || "About");
                    setVal('adm-nav-contact', txt.nav_contact || "Contact");
                    setVal('adm-txt-offer-text', txt.latest_offer_text || "");
                    setVal('adm-sig-feat1', txt.sig_feat1 || "");
                    setVal('adm-sig-feat2', txt.sig_feat2 || "");
                    setVal('adm-sig-feat3', txt.sig_feat3 || "");
                    setVal('adm-stat-success', txt.stat_success || "");

                    // Element Visibility
                    const ev = config.elementVisibility || {};
                    setCheck('adm-vis-offer', ev.hero_offer !== false); // default true
                    setCheck('adm-vis-sig1', ev.sig_feat1 !== false);
                    setCheck('adm-vis-sig2', ev.sig_feat2 !== false);
                    setCheck('adm-vis-sig3', ev.sig_feat3 !== false);
                    setCheck('adm-vis-stat1', ev.stat_success !== false);

                    setCheck('adm-vis-nav-home', ev.nav_home !== false);
                    setCheck('adm-vis-nav-bots', ev.nav_bots !== false);
                    setCheck('adm-vis-nav-signals', ev.nav_signals !== false);
                    setCheck('adm-vis-nav-services', ev.nav_services !== false);
                    setCheck('adm-vis-nav-about', ev.nav_about !== false);
                    setCheck('adm-vis-nav-contact', ev.nav_contact !== false);

                    setCheck('adm-vis-nav-about', ev.nav_about !== false);
                    setCheck('adm-vis-nav-contact', ev.nav_contact !== false);

                    // Specific Text Overrides
                    setVal('adm-txt-hero-suffix', txt.hero_suffix || "Automated.");
                    setVal('adm-txt-bots-sub', txt.bots_subtitle || "Discover our range of high-precision MT5 Expert Advisors.");
                    setVal('adm-txt-serv-1', txt.serv_badge_1 || "Custom Trading Bot Development");
                    setVal('adm-txt-serv-2', txt.serv_badge_2 || "");
                    setVal('adm-txt-serv-3', txt.serv_badge_3 || "");
                    setVal('adm-txt-serv-4', txt.serv_badge_4 || "");

                    setVal('adm-txt-sig-brief-title', txt.sig_brief_title || "Today's Audio Briefing");
                    setVal('adm-txt-sig-brief-desc', txt.sig_brief_desc || "Daily market outlook...");

                    // Links
                    const lnks = config.links || {};
                    setVal('adm-link-fb', lnks.facebook || "");
                    setVal('adm-link-pin', lnks.pinterest || "");
                    setVal('adm-link-email', lnks.email || "");

                    // Wallets
                    const wall = config.wallets || {};
                    setVal('adm-wallet-usdt', wall.usdt || "TR7NHqjeKQxGTCi8q8zy4pL8otSzgjLj6t");
                    setVal('adm-wallet-ltc', wall.ltc || "LM2nyQpYFp1e8oM7i8E4qN1D4vK5sR1zT9");
                    setVal('adm-wallet-payeer', wall.payeer || "P1000200030");

                    // SEO & Profile
                    setVal('adm-app-meta', app.metaDesc || "");
                    setVal('adm-app-profile-base64', app.profileBase64 || "");
                    const profPreview = document.getElementById('profile-img-preview');
                    if (profPreview && app.profileBase64) {
                        profPreview.style.backgroundImage = `url(${app.profileBase64})`;
                        profPreview.style.display = 'block';
                    }

                    // Products - Managed exclusively via Firebase to prevent local storage quota issues.
                    renderProductList();

                    // Refresh Dynamic Sections UI
                    if (typeof refreshCustomSectionsList === 'function') refreshCustomSectionsList();
                } catch (err) {
                    console.error('CRITICAL: loadSettings failed:', err);
                }
            }

            function renderProductList() {
                const list = document.getElementById('adm-prod-list');
                list.innerHTML = '';

                // Re-sync with memory to ensure we have latest
                console.log('Rendering list with', currentProducts.length, 'products');

                if (currentProducts.length === 0) {
                    list.innerHTML = '<p style="text-align:center; opacity:0.5; padding:1rem; border:1px dashed var(--border-color);">No custom products. Using defaults.</p>';
                }

                currentProducts.forEach((p, idx) => {
                    const imgUrl = (p.image && p.image.length > 50) ? p.image : (p.image || 'images/bot1.png');
                    const div = document.createElement('div');
                    div.className = 'admin-product-item';
                    div.style.cssText = 'background:var(--bg-color); padding:0.8rem; border-radius:8px; display:flex; justify-content:space-between; align-items:center; border:1px solid var(--border-color); margin-bottom:0.5rem;';
                    div.innerHTML = `
                    <div style="display:flex; align-items:center; gap:1rem;">
                        <img src="${imgUrl}" style="width:40px; height:40px; object-fit:cover; border-radius:5px; border:1px solid var(--border-color);">
                        <div>
                            <div style="font-weight:bold; font-size:0.9rem;">${p.title}</div>
                            <div style="font-size:0.8rem; display:flex; gap:0.5rem; align-items:center;">
                                <span style="color:var(--primary-color);">${isProductFree(p) ? '<span style="color:#00D09C; font-weight:bold;">FREE</span>' : '$' + p.price}</span>
                                ${p.fileData ? '<span style="background:#00D09C; color:white; font-size:0.6rem; padding:1px 4px; border-radius:3px;"><i class="fas fa-file-archive"></i> FILE OK</span>' : '<span style="background:#ff4d4d; color:white; font-size:0.6rem; padding:1px 4px; border-radius:3px;">NO FILE</span>'}
                            </div>
                        </div>
                    </div>
                    <div style="display:flex; gap:0.3rem;">
                        <button onclick="editProduct(${idx})" style="color:var(--primary-color); background:none; border:none; cursor:pointer; padding:0.5rem;"><i class="fas fa-edit"></i></button>
                        <button onclick="removeProduct(${idx})" style="color:#ff4d4d; background:none; border:none; cursor:pointer; padding:0.5rem;"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                    list.appendChild(div);
                });

                // Update a counter if it exists (good for UX)
                const saveBtn = document.querySelector('button[onclick*="saveSettings"]');
                if (saveBtn) saveBtn.innerHTML = `Save All Changes (${currentProducts.length} Products)`;
            }

            function previewImage(input) {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const base64 = e.target.result;
                        document.getElementById('new-prod-img-base64').value = base64;
                        const preview = document.getElementById('img-preview-box');
                        preview.style.backgroundImage = `url(${base64})`;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }

            function previewProfileImg(input) {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const base64 = e.target.result;
                        document.getElementById('adm-app-profile-base64').value = base64;
                        const preview = document.getElementById('profile-img-preview');
                        preview.style.backgroundImage = `url(${base64})`;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }

            function handleProductFile(input) {
                if (input.files && input.files[0]) {
                    const file = input.files[0];
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        document.getElementById('new-prod-file-data').value = e.target.result;
                        document.getElementById('new-prod-file-name').value = file.name;
                        document.getElementById('file-name-display').textContent = file.name;
                        document.getElementById('file-name-display').style.color = 'var(--primary-color)';
                        document.getElementById('remove-file-btn').style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            }

            function removeProductFile() {
                if (confirm("Are you sure you want to remove this file?")) {
                    document.getElementById('new-prod-file-data').value = '';
                    document.getElementById('new-prod-file-name').value = '';
                    document.getElementById('file-name-display').textContent = 'No file selected';
                    document.getElementById('file-name-display').style.color = 'inherit';
                    document.getElementById('remove-file-btn').style.display = 'none';
                    document.getElementById('new-prod-file-input').value = ''; // Reset file input
                }
            }

            function cancelProductEdit() {
                editingIndex = -1;
                const titleEl = document.getElementById('adm-prod-form-title');
                if (titleEl) titleEl.textContent = 'Add New Product';

                const btn = document.getElementById('add-prod-btn');
                if (btn) {
                    btn.innerHTML = '<i class="fas fa-plus-circle"></i> Add Product to Website';
                    btn.style.background = 'var(--primary-color)';
                }

                document.getElementById('cancel-edit-btn').style.display = 'none';

                // Clear fields
                document.getElementById('new-prod-title').value = '';
                document.getElementById('new-prod-price').value = '';
                document.getElementById('new-prod-desc').value = '';
                document.getElementById('new-prod-is-free').checked = false;
                togglePriceField(false);
                document.getElementById('new-prod-img-base64').value = '';
                document.getElementById('img-preview-box').style.display = 'none';
                document.getElementById('new-prod-file-data').value = '';
                document.getElementById('new-prod-file-name').value = '';
                document.getElementById('file-name-display').textContent = 'No file selected';
                document.getElementById('remove-file-btn').style.display = 'none';
            }

            function editProduct(idx) {
                editingIndex = idx;
                const p = currentProducts[idx];
                if (!p) return;

                const titleEl = document.getElementById('adm-prod-form-title');
                if (titleEl) titleEl.textContent = 'Editing: ' + p.title;

                const btn = document.getElementById('add-prod-btn');
                if (btn) {
                    btn.innerHTML = '<i class="fas fa-save"></i> Update Product Details';
                    btn.style.background = '#ffaa00';
                }

                document.getElementById('cancel-edit-btn').style.display = 'inline-block';

                const isFree = p.isFree || false;
                document.getElementById('new-prod-is-free').checked = isFree;
                togglePriceField(isFree);

                document.getElementById('new-prod-title').value = p.title;
                document.getElementById('new-prod-price').value = p.price || '';
                document.getElementById('new-prod-desc').value = p.desc || '';

                if (p.fileData && p.fileName) {
                    document.getElementById('new-prod-file-data').value = p.fileData;
                    document.getElementById('new-prod-file-name').value = p.fileName;
                    document.getElementById('file-name-display').textContent = p.fileName;
                    document.getElementById('remove-file-btn').style.display = 'block';
                } else {
                    document.getElementById('new-prod-file-data').value = '';
                    document.getElementById('new-prod-file-name').value = '';
                    document.getElementById('file-name-display').textContent = 'No file selected';
                    document.getElementById('remove-file-btn').style.display = 'none';
                }

                if (p.image && p.image.startsWith('data:image')) {
                    document.getElementById('new-prod-img-base64').value = p.image;
                    const preview = document.getElementById('img-preview-box');
                    preview.style.backgroundImage = `url(${p.image})`;
                    preview.style.display = 'block';
                } else {
                    document.getElementById('new-prod-img-base64').value = '';
                    document.getElementById('img-preview-box').style.display = 'none';
                }
            }

            function addNewProduct() {
                const titleInput = document.getElementById('new-prod-title');
                const priceInput = document.getElementById('new-prod-price');
                const imgBase64 = document.getElementById('new-prod-img-base64').value;
                const descInput = document.getElementById('new-prod-desc');
                const fileData = document.getElementById('new-prod-file-data').value;
                const fileName = document.getElementById('new-prod-file-name').value;
                const isFree = document.getElementById('new-prod-is-free').checked;

                const title = titleInput.value.trim();
                let price = priceInput.value.trim();

                if (!isFree && (!price || parseFloat(price) <= 0)) {
                    alert("Please enter a valid price (greater than 0) for the premium product.");
                    return;
                }

                if (!title) {
                    alert("Please enter a product title.");
                    return;
                }

                const btn = document.getElementById('add-prod-btn');
                const originalBtnHTML = btn ? btn.innerHTML : '+ Add Product';
                if (btn) {
                    btn.disabled = true;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Syncing...';
                }

                let list = [...currentProducts];

                if (editingIndex > -1) {
                    // Update existing
                    list[editingIndex] = {
                        ...list[editingIndex],
                        title: title,
                        price: isFree ? "0" : price,
                        image: imgBase64 || list[editingIndex].image,
                        desc: descInput.value || '',
                        fileData: fileData || list[editingIndex].fileData,
                        fileName: fileName || list[editingIndex].fileName,
                        isFree: isFree
                    };
                } else {
                    // Add new
                    const newBot = {
                        id: Date.now(),
                        title: title,
                        price: isFree ? "0" : price,
                        image: imgBase64 || 'images/bot1.png',
                        desc: descInput.value || '',
                        fileData: fileData || null,
                        fileName: fileName || null,
                        isFree: isFree
                    };
                    list.push(newBot);
                }

                // Sync to Firebase
                db.ref('products').set(list).then(() => {
                    console.log("✅ Cloud Sync Success! Total:", list.length);
                    alert(editingIndex > -1 ? "Product Updated!" : "New Product Added!");
                    cancelProductEdit(); // This resets editingIndex, button, and fields
                    renderProductList();
                }).catch(err => {
                    console.error("❌ Cloud Sync Error:", err);
                    alert("Database sync failed. Please try again.");
                }).finally(() => {
                    if (btn) {
                        btn.disabled = false;
                        btn.innerHTML = originalBtnHTML;
                    }
                });
            }

            async function clearCloudDatabase() {
                if (!confirm("CRITICAL: This will delete ALL products from your website forever. Are you absolutely sure?")) return;
                try {
                    await db.ref('products').set(null);
                    currentProducts = [];
                    renderProductList();
                    alert("Cloud database has been wiped clean.");
                } catch (err) {
                    alert("Failed to wipe cloud. Check console.");
                }
            }

            async function removeProduct(idx) {
                if (!confirm("Are you sure you want to PERMANENTLY delete this product?")) return;

                // 1. Update local memory immediately
                currentProducts.splice(idx, 1);
                const newList = [...currentProducts];

                // 2. Sync to Firebase
                try {
                    await db.ref('products').set(newList);
                    console.log("Deleted from cloud successfully.");
                    alert("Product deleted!");
                    renderProductList();
                } catch (err) {
                    console.error("Delete failed:", err);
                    alert("Cloud sync failed. Product may return.");
                }
            }

            function saveSettings(alertUser = false) {
                try {
                    // 1. Read latest state from storage to prevent data loss
                    const storageData = JSON.parse(localStorage.getItem(CONFIG_KEY)) || {};

                    const getValue = (id, defaultVal = '') => {
                        const el = document.getElementById(id);
                        return el ? el.value : defaultVal;
                    };
                    const getChecked = (id, defaultVal = true) => {
                        const el = document.getElementById(id);
                        return el ? el.checked : defaultVal;
                    };

                    // 2. Build new config, merging with existing where applicable
                    const config = {
                        ...storageData,
                        visibility: {
                            bots: getChecked('adm-vis-bots'),
                            signals: getChecked('adm-vis-signals'),
                            services: getChecked('adm-vis-services'),
                            about: getChecked('adm-vis-about')
                        },
                        appearance: {
                            siteTitle: getValue('adm-app-title', 'Trading Made Easy'),
                            primaryColor: getValue('adm-app-color', '#00ff88'),
                            borderRadius: getValue('adm-app-radius', '10px'),
                            metaDesc: getValue('adm-app-meta'),
                            profileBase64: getValue('adm-app-profile-base64')
                        },
                        textOverrides: {
                            hero_title: getValue('adm-txt-hero'),
                            hero_desc: getValue('adm-txt-hero-desc'),
                            about_bio: getValue('adm-txt-about'),
                            ticker_msgs: getValue('adm-txt-ticker'),
                            // New Section Titles
                            bots_title: getValue('adm-txt-bots-title'),
                            signals_title: getValue('adm-txt-signals-title'),
                            services_title: getValue('adm-txt-services-title'),
                            stats_title: getValue('adm-txt-stats-title'),
                            pay_title: getValue('adm-txt-pay-title'),
                            contact_title: getValue('adm-txt-contact-title'),
                            // Detailed Overrides
                            about_role: getValue('adm-txt-about-role'),
                            nav_home: getValue('adm-nav-home'),
                            nav_bots: getValue('adm-nav-bots'),
                            nav_signals: getValue('adm-nav-signals'),
                            nav_services: getValue('adm-nav-services'),
                            nav_about: getValue('adm-nav-about'),
                            nav_contact: getValue('adm-nav-contact'),
                            // Specifics
                            hero_suffix: getValue('adm-txt-hero-suffix'),
                            bots_subtitle: getValue('adm-txt-bots-sub'),
                            serv_badge_1: getValue('adm-txt-serv-1'),
                            serv_badge_2: getValue('adm-txt-serv-2'),
                            serv_badge_3: getValue('adm-txt-serv-3'),
                            serv_badge_4: getValue('adm-txt-serv-4'),

                            sig_brief_title: getValue('adm-txt-sig-brief-title'),
                            sig_brief_desc: getValue('adm-txt-sig-brief-desc'),

                            latest_offer_text: getValue('adm-txt-offer-text'),
                            sig_feat1: getValue('adm-sig-feat1'),
                            sig_feat2: getValue('adm-sig-feat2'),
                            sig_feat3: getValue('adm-sig-feat3'),
                            stat_success: getValue('adm-stat-success')
                        }
                    };

                    // 2.1 Collect Custom Sections Overrides Automatically
                    const customSecs = storageData.customSections || [];
                    customSecs.forEach(sec => {
                        const customTitle = getValue(`adm-txt-${sec.id}-title`);
                        const customContent = getValue(`adm-txt-${sec.id}-content`);
                        const customPlacement = getValue(`adm-txt-${sec.id}-placement`);
                        const customAlign = getValue(`adm-txt-${sec.id}-align`);
                        const customIcon = getValue(`adm-txt-${sec.id}-icon`);

                        if (customTitle) config.textOverrides[sec.id + '_title'] = customTitle;
                        if (customContent) config.textOverrides[sec.id + '_content'] = customContent;
                        if (customPlacement) config.textOverrides[sec.id + '_placement'] = customPlacement;
                        if (customAlign) config.textOverrides[sec.id + '_align'] = customAlign;
                        if (customIcon) config.textOverrides[sec.id + '_icon'] = customIcon;
                    });

                    config.elementVisibility = {
                        hero_offer: getChecked('adm-vis-offer', true),
                        sig_feat1: getChecked('adm-vis-sig1', true),
                        sig_feat2: getChecked('adm-vis-sig2', true),
                        sig_feat3: getChecked('adm-vis-sig3', true),
                        stat_success: getChecked('adm-vis-stat1', true),
                        // Nav
                        nav_home: getChecked('adm-vis-nav-home', true),
                        nav_bots: getChecked('adm-vis-nav-bots', true),
                        nav_signals: getChecked('adm-vis-nav-signals', true),
                        nav_services: getChecked('adm-vis-nav-services', true),
                        nav_about: getChecked('adm-vis-nav-about', true),
                        nav_contact: getChecked('adm-vis-nav-contact', true)
                    };

                    config.links = {
                        facebook: getValue('adm-link-fb'),
                        pinterest: getValue('adm-link-pin'),
                        email: getValue('adm-link-email')
                    };

                    config.wallets = {
                        usdt: getValue('adm-wallet-usdt'),
                        ltc: getValue('adm-wallet-ltc'),
                        payeer: getValue('adm-wallet-payeer')
                    };

                    config.sectionsConfig = getSectionsState(); // SAVE NEW SECTIONS STATE

                    console.log('FINAL SAVE: Saving following config:', config);
                    try {
                        localStorage.setItem(CONFIG_KEY, JSON.stringify(config));
                    } catch (e) {
                        console.warn("LocalStorage failed (possibly full), proceeding anyway:", e);
                    }

                    if (alertUser) {
                        const btn = document.getElementById('final-save-btn');
                        if (btn) {
                            btn.disabled = true;
                            btn.innerHTML = '<i class="fas fa-sync fa-spin"></i> Saving...';
                        }

                        // Apply locally immediately
                        applySiteSettings();

                        console.log("Syncing config to cloud...", config);

                        // Use a promise with timeout
                        const syncWithTimeout = (ref, data, ms) => {
                            const timeout = new Promise((_, reject) => setTimeout(() => reject(new Error('Sync Timeout')), ms));
                            const sync = ref.set(data);
                            return Promise.race([sync, timeout]);
                        };

                        syncWithTimeout(db.ref('site_config'), config, 5000)
                            .then(() => {
                                console.log("Cloud sync success. Reloading page.");
                                window.location.reload();
                            })
                            .catch(err => {
                                console.warn("Cloud sync failed or timed out:", err);
                                // Reload anyway so user sees local result at least on next refresh from localstorage
                                window.location.reload();
                            });
                    }
                } catch (err) {
                    console.error("saveSettings Error:", err);
                    alert("An error occurred while saving: " + err.message);
                    const btn = document.getElementById('final-save-btn');
                    if (btn) {
                        btn.disabled = false;
                        btn.innerHTML = 'Save All Changes';
                    }
                }
            }

            // --- SECTIONS MANAGER ---
            function getSectionList() {
                // Identify all main sections on the page
                const sections = Array.from(document.querySelectorAll('section[id]')).map(sec => sec.id).filter(id => id !== 'admin-quick-access');
                return sections;
            }

            function refreshSectionList() {
                const editorInfo = document.getElementById('sections-list-editor');
                if (!editorInfo) return;

                // Get current config to check status
                const storedConfig = JSON.parse(localStorage.getItem(CONFIG_KEY)) || {};
                const sectionsConfig = storedConfig.sectionsConfig || {};
                // Determine order: use saved order or default DOM order
                let allSections = getSectionList();

                // If we have a saved order, try to respect it, appending new sections at the end
                let displayOrder = [];
                if (sectionsConfig.order && sectionsConfig.order.length > 0) {
                    displayOrder = sectionsConfig.order.filter(id => allSections.includes(id));
                    // Add any new sections not in saved order
                    allSections.forEach(id => {
                        if (!displayOrder.includes(id)) displayOrder.push(id);
                    });
                } else {
                    displayOrder = allSections;
                }

                let html = '';
                displayOrder.forEach(id => {
                    const isHidden = sectionsConfig.hidden && sectionsConfig.hidden.includes(id);
                    html += `
                    <div class="section-item" data-id="${id}" style="background:var(--bg-color); border:1px solid var(--border-color); padding:1rem; border-radius:5px; display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-weight:600; text-transform:capitalize;">${id.replace('-', ' ')}</span>
                        <div style="display:flex; gap:0.5rem;">
                            <button onclick="moveSection('${id}', -1)" class="btn" style="padding:0.3rem 0.6rem; font-size:0.8rem;"><i class="fas fa-arrow-up"></i></button>
                            <button onclick="moveSection('${id}', 1)" class="btn" style="padding:0.3rem 0.6rem; font-size:0.8rem;"><i class="fas fa-arrow-down"></i></button>
                            <button onclick="toggleSectionVisibility('${id}')" class="btn" style="${isHidden ? 'opacity:0.5' : 'color:var(--primary-color)'}; padding:0.3rem 0.6rem;">
                                <i class="fas ${isHidden ? 'fa-eye-slash' : 'fa-eye'}"></i>
                            </button>
                        </div>
                    </div>
                 `;
                });
                editorInfo.innerHTML = html;
            }

            // Helper to grab current state from UI to save
            function getSectionsState() {
                const items = document.querySelectorAll('.section-item');
                const order = [];
                const hidden = [];
                items.forEach(item => {
                    const id = item.getAttribute('data-id');
                    order.push(id);
                    // Check eye icon state
                    const eye = item.querySelector('.fa-eye-slash');
                    if (eye) hidden.push(id);
                });
                return { order, hidden };
            }

            function toggleSectionVisibility(id) {
                const btn = document.querySelector(`.section-item[data-id="${id}"] .fa-eye, .section-item[data-id="${id}"] .fa-eye-slash`);
                if (btn) {
                    if (btn.classList.contains('fa-eye')) {
                        btn.classList.remove('fa-eye');
                        btn.classList.add('fa-eye-slash');
                        btn.parentElement.style.opacity = '0.5';
                        btn.parentElement.style.color = 'inherit';
                    } else {
                        btn.classList.remove('fa-eye-slash');
                        btn.classList.add('fa-eye');
                        btn.parentElement.style.opacity = '1';
                        btn.parentElement.style.color = 'var(--primary-color)';
                    }
                }
            }

            function moveSection(id, direction) {
                const items = Array.from(document.querySelectorAll('.section-item'));
                const index = items.findIndex(el => el.getAttribute('data-id') === id);
                if (index < 0) return;

                const parent = document.getElementById('sections-list-editor');
                if (direction === -1 && index > 0) {
                    parent.insertBefore(items[index], items[index - 1]);
                } else if (direction === 1 && index < items.length - 1) {
                    parent.insertBefore(items[index + 1], items[index]); // Insert next before current = swap
                    // Actually insertBefore inserts *before* the reference node. 
                    // To move down: insert current before next's next sibling?
                    // Easier: insert next before current
                    parent.insertBefore(items[index], items[index + 1].nextSibling);
                }
            }

            async function addCustomSection(e) {
                if (e) e.preventDefault();
                const addBtn = e ? e.currentTarget : document.querySelector('button[onclick="addCustomSection(event)"]');
                const originalHTML = addBtn ? addBtn.innerHTML : 'Create Section';

                try {
                    const titleInput = document.getElementById('new-sec-title');
                    const contentInput = document.getElementById('new-sec-content');
                    const placementInput = document.getElementById('new-sec-placement');
                    const alignInput = document.getElementById('new-sec-align');
                    const iconInput = document.getElementById('new-sec-icon');

                    const title = titleInput.value.trim();
                    const content = contentInput.value.trim();
                    const placement = placementInput ? placementInput.value : 'body';
                    const align = alignInput ? alignInput.value : 'center';
                    const icon = iconInput ? iconInput.value : '';

                    if (!title || !content) {
                        alert("Title and content are required.");
                        return;
                    }

                    if (addBtn) {
                        addBtn.disabled = true;
                        addBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Syncing...';
                    }

                    // 1. Get current config from LocalStorage (Source of Truth)
                    const config = JSON.parse(localStorage.getItem(CONFIG_KEY)) || {};
                    config.customSections = config.customSections || [];
                    config.textOverrides = config.textOverrides || {};
                    config.sectionsConfig = config.sectionsConfig || { order: [], hidden: [] };
                    if (!config.sectionsConfig.order) config.sectionsConfig.order = [];

                    // 2. Create New ID and add to Lists
                    const newId = 'custom-sec-' + Date.now();

                    // Add to raw list with NEW metadata
                    config.customSections.push({
                        id: newId,
                        title,
                        content,
                        placement,
                        align,
                        icon
                    });

                    // Add to overrides to ensure consistency
                    config.textOverrides[newId + '_title'] = title;
                    config.textOverrides[newId + '_content'] = content;
                    config.textOverrides[newId + '_placement'] = placement;
                    config.textOverrides[newId + '_align'] = align;
                    config.textOverrides[newId + '_icon'] = icon;

                    // Add to layout order (at the bottom)
                    if (!config.sectionsConfig.order.includes(newId)) {
                        config.sectionsConfig.order.push(newId);
                    }

                    console.log("Saving new section to cloud:", newId);

                    // 3. Save to LocalStorage
                    localStorage.setItem(CONFIG_KEY, JSON.stringify(config));

                    // 4. Sync to Cloud and Reload (Same Logic as Variables)
                    await db.ref('site_config').set(config);

                    console.log("Cloud sync complete. Reloading...");
                    window.location.reload();

                } catch (err) {
                    console.error("addCustomSection error:", err);
                    alert("Error: " + err.message);
                    if (addBtn) {
                        addBtn.disabled = false;
                        addBtn.innerHTML = originalHTML;
                    }
                }
            }

            // FLAG to prevent listener loops while saving
            let isPerformingCloudAction = false;

            async function removeCustomSection(id) {
                if (!confirm("Are you sure you want to delete this element permanently?")) return;

                if (isPerformingCloudAction) return;
                isPerformingCloudAction = true;

                try {
                    console.log("Starting Hard Delete for:", id);

                    // 1. Fetch FRESH data from Cloud to be 100% sure we have the latest
                    const snapshot = await db.ref('site_config').once('value');
                    let config = snapshot.val() || { customSections: [], textOverrides: {}, sectionsConfig: { order: [] } };

                    // 2. Perform Filtering on the FRESH data
                    if (config.customSections) {
                        config.customSections = config.customSections.filter(s => s.id !== id);
                    }

                    // 3. Clean up order list
                    if (config.sectionsConfig && config.sectionsConfig.order) {
                        config.sectionsConfig.order = config.sectionsConfig.order.filter(oid => oid !== id);
                    }
                    if (config.sectionsConfig && config.sectionsConfig.hidden) {
                        config.sectionsConfig.hidden = config.sectionsConfig.hidden.filter(hid => hid !== id);
                    }

                    // 4. Clean up all associated overrides
                    if (config.textOverrides) {
                        const keysToDelete = Object.keys(config.textOverrides).filter(key => key.startsWith(id));
                        keysToDelete.forEach(key => delete config.textOverrides[key]);
                    }

                    // 5. Hard Write back to Firebase (This overrides EVERYTHING in the cloud)
                    await db.ref('site_config').set(config);

                    // 6. Update LocalStorage only AFTER successful cloud write
                    localStorage.setItem(CONFIG_KEY, JSON.stringify(config));

                    console.log("Delete finalized in cloud. LIVE UPDATE.");

                    // 7. Updates UI instantly without reload
                    applySiteSettings();
                    refreshCustomSectionsList();
                    if (typeof refreshSectionList === 'function') refreshSectionList();

                } catch (err) {
                    console.error("Hard Delete Failed:", err);
                    alert("Sync Error: " + err.message);
                } finally {
                    isPerformingCloudAction = false;
                }
            }

            function refreshCustomSectionsList() {
                const textEdits = document.getElementById('custom-sections-text-edits');
                if (!textEdits) return;

                const config = JSON.parse(localStorage.getItem(CONFIG_KEY)) || {};
                const customSecs = config.customSections || [];

                if (customSecs.length === 0) {
                    textEdits.innerHTML = '<p style="font-size:0.75rem; opacity:0.5; text-align:center; padding:1rem;">Add dynamic elements to see them here.</p>';
                    return;
                }

                let editHtml = '<h4 style="margin-bottom:1.5rem; opacity:0.8; font-weight:bold;"><i class="fas fa-edit"></i> Manage Custom Elements</h4>';

                customSecs.forEach(sec => {
                    // Text Edits
                    const titleVal = String((config.textOverrides && config.textOverrides[sec.id + '_title']) || sec.title || "");
                    const contentVal = String((config.textOverrides && config.textOverrides[sec.id + '_content']) || sec.content || "");
                    const placementVal = String((config.textOverrides && config.textOverrides[sec.id + '_placement']) || sec.placement || "body");
                    const alignVal = String((config.textOverrides && config.textOverrides[sec.id + '_align']) || sec.align || "center");
                    const iconVal = String((config.textOverrides && config.textOverrides[sec.id + '_icon']) || sec.icon || "");

                    editHtml += `
                        <div style="margin-bottom:2rem; padding:1rem; border:1px solid var(--border-color); border-radius:8px; background:rgba(255,255,255,0.02); position:relative;">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; border-bottom:1px dashed var(--border-color); padding-bottom:0.5rem;">
                                <label style="font-size:0.85rem; font-weight:bold; color:var(--primary-color);">Edit: ${sec.title || "New Element"}</label>
                                <button onclick="removeCustomSection('${sec.id}')" 
                                    style="background:rgba(255,77,77,0.1); border:1px solid #ff4d4d; color:#ff4d4d; padding:0.2rem 0.5rem; border-radius:4px; font-size:0.7rem; cursor:pointer; transition:0.3s;">
                                    <i class="fas fa-trash"></i> Delete Permanent
                                </button>
                            </div>
                            
                            <div style="display:grid; gap:0.5rem;">
                                <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.5rem;">
                                    <div>
                                        <label style="font-size:0.7rem; opacity:0.6;">Display Title</label>
                                        <input type="text" id="adm-txt-${sec.id}-title" value="${titleVal.replace(/"/g, '&quot;')}" 
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                    <div>
                                        <label style="font-size:0.7rem; opacity:0.6;">Placement Location</label>
                                        <select id="adm-txt-${sec.id}-placement" style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                            <option value="body" ${placementVal === 'body' ? 'selected' : ''}>Main Body</option>
                                            <option value="navbar" ${placementVal === 'navbar' ? 'selected' : ''}>Navbar</option>
                                            <option value="sidebar-left" ${placementVal === 'sidebar-left' ? 'selected' : ''}>Left Sidebar</option>
                                            <option value="sidebar-right" ${placementVal === 'sidebar-right' ? 'selected' : ''}>Right Sidebar</option>
                                            <option value="footer" ${placementVal === 'footer' ? 'selected' : ''}>Footer</option>
                                        </select>
                                    </div>
                                </div>
                                <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.5rem;">
                                    <div>
                                        <label style="font-size:0.7rem; opacity:0.6;">Text Alignment</label>
                                        <select id="adm-txt-${sec.id}-align" style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                            <option value="left" ${alignVal === 'left' ? 'selected' : ''}>Left</option>
                                            <option value="center" ${alignVal === 'center' ? 'selected' : ''}>Center</option>
                                            <option value="right" ${alignVal === 'right' ? 'selected' : ''}>Right</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label style="font-size:0.7rem; opacity:0.6;">FontAwesome Icon</label>
                                        <input type="text" id="adm-txt-${sec.id}-icon" value="${iconVal}" placeholder="fas fa-star"
                                            style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">
                                    </div>
                                </div>
                                <div>
                                    <label style="font-size:0.7rem; opacity:0.6;">Content / Link URL</label>
                                    <textarea id="adm-txt-${sec.id}-content" rows="2" 
                                        style="width:100%; padding:0.5rem; background:var(--bg-color); border:1px solid var(--border-color); color:var(--text-color); border-radius:4px;">${contentVal}</textarea>
                                </div>
                            </div>
                        </div>
                    `;
                });

                textEdits.innerHTML = editHtml;
            }

            function togglePriceField(isFree) {
                const priceWrapper = document.getElementById('price-field-wrapper');
                const priceInput = document.getElementById('new-prod-price');
                if (priceWrapper && priceInput) {
                    priceWrapper.style.opacity = isFree ? '0.3' : '1';
                    priceWrapper.style.pointerEvents = isFree ? 'none' : 'auto';
                    if (isFree) priceInput.value = '0';
                }
            }

            // INITIALIZE ON LOAD
            loadSettings();
        </script>
</body>

```